(()=>{"use strict";var t={684:()=>{window.windowBag=window,windowBag.ext||(windowBag.ext={}),windowBag.windowExt=windowBag.ext,windowBag.windowExtBag=windowBag.ext,windowBag.uninit=new Object,windowBag.uninitString=Symbol("uninitialized string"),windowBag.uninitNumber=Symbol("uninitialized number"),windowBag.emptyFunc=function(){},windowBag.lastUIEvent=uninit,windowBag.myGlobalUIEventHandler=function(t){console.log("#myGlobalUIEventHandler, ev=",t),windowBag.lastUIEvent=t};{let t=new Set;windowBag.alreadyExecuted=function(e){if(e.length>41)throw new Error("name len is GT 41, len="+e.length);if(t.has(e))return!0;if(t.size>100)throw new Error("too many items, GT 100");return t.add(e),!1}}windowBag.Config={},windowBag.config=windowBag.Config,windowBag.db=!1,windowBag.False=!1,windowBag.True=!0,windowBag.TrueTodo=!0;{let t={};windowBag.log=t;let e=0;t.info=function(t,r){if("string"==typeof t)r=t+r;else if(!1===t.debugging)return;r=e+": "+r,console.log(r),e++}}windowExtBag.onDOMContentLoaded=function(t){console.log("document.readyState",document.readyState),"loading"===document.readyState||"interactive"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(document.readyState)},window.addEventListener("DOMContentLoaded",(t=>{console.log("window/document DOMContentLoaded event fired",t)})),window.addEventListener("load",(t=>{console.log("window load event fired, document.readyState",document.readyState)})),windowExtBag.scriptLoaded=t=>{console.log("---script loaded",t)},windowBag.getTagNameIDClass=function(t){let e="";return void 0===t?e="undefined":null===t?e="null":"string"==typeof t?e=t:(e=t.tagName,t.id&&(e+="#"+t.id),t.className&&(e+="."+t.className)),e=`selector[${e}]`,e},windowBag.getSelectorShortInfo=function(t,e){let r=getTagNameIDClass(t);return e&&(r+=" in parent: "+getTagNameIDClass(e)),r},windowBag.qsFirstOrDefault=function(t,e){let r,n=qsAll(t,e);return r=n.length>0?n[0]:null,r},windowBag.qsFirst=function(t,e){let r=qsFirstOrDefault(t,e);if(null===r){let r="No element found for "+getSelectorShortInfo(t,e);throw Error(r)}return r},windowBag.qs=function(t,e){if("string"!=typeof t)return t;null==e&&(e=document.body);let r=qsNullable(t,e);if(null==r){let r="No element found for "+getSelectorShortInfo(t,e),n=qsAll(t,document.body);throw n&&n.length>0&&(r+=", <br>but found in document.body count"+n.length),r+=", <br>make sure prefix dot.for class and # for id",Error(r)}return r},windowBag.qsInputElement=function(t,e){let r=qs(t,e);if(!(r instanceof HTMLInputElement))throw Error(getSelectorShortInfo(t,e)+" is not instanceof HTMLInputElement, but instanceof "+r);return r},windowBag.qsClosest=function(t,e){let r=e.closest(t);if(null==r){let r="No element found for selector: "+t+", make sure prefix dot. for class and # for id";throw console.error(r,e),Error(r)}return r},windowBag.qsParent=function(t){let e=qs(t).parentElement;if(null==e)throw Error("No Parent found for elt "+t);return e},windowBag.qsAll=function(t,e){if(!t)throw Error("Argument selector is blank"+t);let r;if(null===e)throw Error("invalid arg, parent is null");if(e===uninit)throw Error("invalid arg, parent is uninit");if(void 0===e)r=document.querySelectorAll(t);else{if(!e.querySelectorAll){let t;throw console.error(t="parent.zzquerySelectorAll is undefined, ",e),Error(t)}r=e.querySelectorAll(t)}return Array.from(r)},windowBag.qsMany=function(t,e=0,r=999,n){e=e||0,r=r||999;let i=qsAll(t,n);const s=i.length;if(s<e)throw Error(`${s} elements found, expect at least ${e}, `+getSelectorShortInfo(t,n));if(s>r)throw Error(`${s} elements found, expect at most ${r}, `+getSelectorShortInfo(t,n));return Array.from(i)},windowBag.qsChildAll=function(t,e){if(!e)throw Error("invalid arg, parent is null or undefined");let r=Array.from(qsAll(t,e)),n=e.children,i=[];for(let t=0;t<n.length;t++){let e=n[t];r.includes(e)&&i.push(e)}return i},windowBag.qsNullable=function(t,e){let r=qsAll(t,e);const n=r.length;if(0===n)return null;if(n>1)throw Error(`Too many elements, ${n}, found for `+getSelectorShortInfo(t,e));return r[0]},windowBag.qsChildNullable=function(t,e){let r=qsChildAll(t,e);const n=r.length;if(0===n)return null;if(n>1)throw Error(`Too many elements, ${n}, found for selector: `+t);return r[0]},windowBag.qsChild=function(t,e){let r=qsChildNullable(t,e);if(null==r)throw Error("No element found for selector: "+t+", make sure prefix dot. for class and # for id");return r},windowBag.Deno={},windowBag.Deno.noColor=!1}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,r),s.exports}(()=>{var t,e,n,i,s,o,a;r(684);class l{static replaceAll(t,e,r){return t}static ciEquals(t,e){return"string"==typeof t&&"string"==typeof e?0===t.localeCompare(e,void 0,{sensitivity:"base"}):t===e}static extractNumber(t){let e,r=t.match(/(\d+)/);if(r){let t=r[0];e=parseInt(t,10)}return console.debug(`${e} extractNumber from ${t}`),e}static isNullOrWhiteSpace(t){let e=!0;return t&&t.trim()&&(e=!1),e}static padLeft(t,e){if("number"==typeof e)return Array(e+1).join(" ")+t;if("string"==typeof e)return e+t;throw new Error(`Expected string or number, got '${e}'.`)}static format(t,...e){return t.replace(/{(\d+)}/g,(function(t,r,n,i){let s=e[r];return void 0!==s?s:t}))}static format_tests(){console.log(l.format("{0} is dead, but {1} is alive! {0} {2}","ASP","ASP.NET"))}static test1(){String.raw`C:\Development\profile\aboutme.html`,String.raw`Hi\n${5}!`}}class c{constructor(t,e){this.storage=t,this.appName=e?e+":":""}fixKey(t){return this.appName+t}tryGetObject(t){t=this.fixKey(t);const e=this.storage.getItem(t);if(null===e)return{success:!1,error:new Error(`Item with key "${t}" does not exist`)};let r;try{r=JSON.parse(e)}catch(t){return{success:!1,error:t}}return{success:!0,value:r}}containsKey(t){return t=this.fixKey(t),null!==this.storage.getItem(t)}containsObject(t){throw"not implemented, use containsKey() method"}getObject(t,e){t=this.fixKey(t);const r=this.storage.getItem(t);if(null===r)throw e||(e=`Item with key "${t}" does not exist`),Error(e);return JSON.parse(r)}removeItem(t){t=this.fixKey(t),this.storage.removeItem(t)}setItem(t,e){t=this.fixKey(t),this.storage.setItem(t,e)}getItem(t){return t=this.fixKey(t),this.storage.getItem(t)}setObject(t,e){t=this.fixKey(t);let r=JSON.stringify(e);this.storage.setItem(t,r)}}class d{static setAppNameAsKeyPrefix(t,e=!0){(e||t===this.default_appName)&&(this.appName=t)}}t=d,d.default_appName="appKeyPrefix-Uninit",d.appName=t.default_appName;class u extends class{constructor(t,e,r){this.itemKey=e,this.storage=new c(t,r)}getObject(t){return this.storage.getObject(this.itemKey,t)}setObject(t){this.storage.setObject(this.itemKey,t)}setCurrentDateTimeStr(){let t=(new Date).toISOString();this.storage.setItem(this.itemKey,t)}removeItem(){this.storage.removeItem(this.itemKey)}setItem(t){this.storage.setItem(this.itemKey,t)}tryGetObject(){return this.storage.tryGetObject(this.itemKey)}containsKey(){return this.storage.containsKey(this.itemKey)}getItemOrFail(){let t=this.itemKey,e=this.storage.getItem(t);if(null===e){let e=`No item found for key: [${t}] in storage: `+typeof this.storage;throw Error(e)}return e}getItemOrDefault(t){let e=this.itemKey,r=this.storage.getItem(e);return null===r?t:r}getItemOrStore(t){let e=this.itemKey,r=this.storage.getItem(e);return null===r&&(this.storage.setItem(e,t),r=t),r}getItem_asBackup(t){let e=this.itemKey,r=t();return null==r?r=this.storage.getItem(e):this.storage.setItem(e,r),r}getItem_asCache(t){return null}}{constructor(t){super(sessionStorage,t,null)}}class h{containsKeyValue(t,e){let r=this.getNullable(t);return l.ciEquals(r,e)}containsKey(t){return null!==this.getNullable(t)}get(t,e=!0){let r=this.getNullable(t);if(null===r&&e)throw Error(`Search Param [${t}] not found in URL`);return r}getOrDefault(t,e){let r=this.getNullable(t);return null===r&&(r=e),r}getInt(t){let e=this.get(t,!0);return parseInt(e,10)}}class p{static pathContains(t){return!!t&&this.urlLower.includes(t.toLowerCase())}static pathContainsSegment(t){return t=t.toLowerCase(),this.pathSegments.some((e=>l.ciEquals(e,t)))}static makeUrlfullyQualified(t){let e;try{e=new URL(t,location.href)}catch(e){throw Error(`[urlHref: ${t}, location.host=${location.host} <br>\n`+e)}return e.href}}e=p,p.pathSegments=uninit,e.urlLower=location.href.toLowerCase(),e.searchParams=new class extends h{constructor(t){super(),this.searchStr="",this.searchStr=t,this.searchParams=new URLSearchParams(t)}getNullable(t){if(!t)throw Error("Invalid arg [name], must not be blank");let e=t.toLowerCase(),r=null,n=!1;for(let i of this.searchParams.entries())if(i[0].toLocaleLowerCase()===e){if(n)throw Error(`already found value for param ${t}`);r=i[1],n=!0}return console.info(`URLSearchParam ${t}, ret=${r}`),r}getOrDefault_HLS(t,e){let r=this.getNullable(t),n=new u("UrlParam:"+t);return null===r?r=n.getItemOrDefault(e):n.setItem(r),r}buildURLSearchPart(t){let e="";if(t instanceof FormData);else for(let r in t)t.hasOwnProperty(r)&&(e.length>0&&(e+="&"),e+=encodeURI(r+"="+t[r]));return e}static fromFormData(t){let e=new URLSearchParams;for(let r of t.entries()){let t=r[1];if(t instanceof File)throw Error("val can't be of type File");e.append(r[0],t)}return e}static test1(){}}(location.search),e.pathSegments=location.pathname.split("/"),console.log("pathFragments=",e.pathSegments.join(", "));class m{static get isMediaScreenMobile(){return this.isRunningInBrowser&&window.screen.width<768}static get isMediaScreenDesktop(){return this.isRunningInBrowser&&768<=window.screen.width}static init(t){this.appName=t,d.setAppNameAsKeyPrefix(t)}static initialize(){var t;if((null===(t=null===window||void 0===window?void 0:window.screen)||void 0===t?void 0:t.width)&&(this.isRunningInBrowser=!0),this.isRunningInBrowser){location.port&&(this.portStart=parseInt(location.port,10)/100);let t=location.hostname.toLowerCase().replace(".ccdoa.net","");this.isExternalProdUrl=t.endsWith(".com")||t.endsWith(".aero"),t.startsWith("beta."),this.isLocalhost=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))}this.isLocalDev=this.isLocalhost,this.isDebug="1"===p.searchParams.getOrDefault_HLS("zz-db","0"),this.isLocalDebug=this.isLocalhost&&this.isDebug,db=this.isDebug,this.isLocalTesting=this.isLocalhost&&p.searchParams.containsKey("zz-test"),Config.isDebug=this.isDebug,Config.isLocalDebug=this.isLocalDebug,console.log("ConfigX.initialize() complete")}static get DataApiUrlRoot(){let t=this._DataApiUrlRoot;return t!==uninitString||(t=this.isRunningOnWebpackDevServer?"http://localhost:3131/":"/",console.log("thisClass.DataApiUrlRoot="+t),this._DataApiUrlRoot=t),t}static get isRunningOnWebpackDevServer(){return"localhost:3132"===window.location.host}static setDataApiUrlBase(t){this.DataApiUrlBase=t}static initDataApiUrlBase(t){t.endsWith("/")||(t+="/"),this.DataApiUrlBase=`${m.DataApiUrlRoot}${t}`}static get dbEnv(){return this._dbEnv}static isEnv(t){if(!this.dbEnv)throw Error("dbEnv not set");return 0===this.dbEnv.localeCompare(t,void 0,{sensitivity:"base"})}static get isDbDev(){return this.isEnv("Dev")}static get isDbQA(){return this.isEnv("Test")||this.isEnv("QA")}static get isDbProd(){return this.isEnv("Prod")}static ensureDbNonProd(){if(this.isDbProd)throw Error("cannot test in Prod")}static get isWindowBeingIframed(){let t=parent!==window;return window.top,window.self,t}static get isWindowBeingPoppedup(){let t;return t=window.locationbar.visible,t}static get isAdminMode(){let t=location.href.toLowerCase();return t.includes("mode=admin")&&!t.includes("mode=adminz")}static get publicFacingUrlRoot(){return this._publicFacingUrlRoot}static getPublicFacingPageUrl(t){let e=this._publicFacingUrlRoot;return e+=t,e}}function g(t,e,r,n){let i=document.createElement(t);if(r&&(i.className=r),e&&e.appendChild(i),null==n);else if("string"==typeof n)i.textContent=n;else if("number"==typeof n)i.textContent=n.toString();else if("boolean"==typeof n)i.textContent=n.toString();else{if(!(n instanceof Date))throw Error("unknown type: "+typeof n);i.textContent=n.toISOString()}return i}m.apiVersion=uninitString,m.appName="uninit",m.isLocalhost=!1,m.isLocalDev=!1,m.isLocalTesting=!1,m.portStart=0,m.isExternalProdUrl=!1,m.isDebug=!1,m.isLocalDebug=!1,m.isRunningInBrowser=!1,m.appRunId="appRunId"+(new Date).getTime(),m._DataApiUrlRoot=uninitString,m.DataApiVersion="?",m.DataApiUrlBase="uninit",m._dbEnv="",m.isAdminApp=!0,m._publicFacingUrlRoot="",console.log("static of ConfigX"),m.initialize(),windowBag.ConfigX=m;class f{createElt_eg2(t,e,r="div"){let n=document.createElement(r);return n.className=t,e.appendChild(n),n}static a(t,e){return this.a_pc(null,null,t,e)}static a_p(t,e,r){return this.a_pc(t,null,e,r)}static a_c(t,e,r){return this.a_pc(null,t,e,r)}static a_pc(t,e,r,n){let i=g("a",t,e,n);return r&&(i.href=r),i}static script_p(t,e){let r=g("script",t,null);return e&&(r.src=e),r}static td_t(t){return this.td_pc(null,null,t)}static td_p(t,e){return this.td_pc(t,null,e)}static td_c(t,e){return this.td_pc(null,t,e)}static td_pc(t,e,r){let n=g("td",t,e,r);return document.createElement("td"),n}static div_t(t){return this.div_pc(null,null,t)}static div_p(t,e){return this.div_pc(t,null,e)}static div_c(t,e){return this.div_pc(null,t,e)}static div_pc(t,e,r){return g("div",t,e,r)}static span_t(t){return this.span_pc(null,null,t)}static span_html(t){let e=this.span_pc(null,null,t);return e.innerHTML=t,e}static span_p(t,e){return this.span_pc(t,null,e)}static span_c(t,e){return this.span_pc(null,t,e)}static span_pc(t,e,r){return g("span",t,e,r)}static ol_p(t,e){return this.ol_pc(t,null,e)}static ol_c(t,e){return this.ol_pc(null,t,e)}static ol_pc(t,e,r){return g("ol",t,e,r)}static select_p(t,e){return this.select_pc(t,null,e)}static select_c(t,e){return this.select_pc(null,t,e)}static select_pc(t,e,r){return g("select",t,e,r)}static option_p(t,e){return this.option_pc(t,null,e)}static option_c(t,e){return this.option_pc(null,t,e)}static option_pc(t,e,r){return g("option",t,e,r)}static ul_p(t,e){return this.ul_pc(t,null,e)}static ul_c(t,e){return this.ul_pc(null,t,e)}static ul_pc(t,e,r){return g("ul",t,e,r)}static li_t(t){return this.li_pc(null,null,t)}static li_p(t,e){return this.li_pc(t,null,e)}static li_c(t,e){return this.li_pc(null,t,e)}static li_pc(t,e,r){return g("li",t,e,r)}static hr_p(t,e){return this.hr_pc(t,null,e)}static hr_c(t,e){return this.hr_pc(null,t,e)}static hr_pc(t,e,r){return g("hr",t,e,r)}static Test1(){f.div_t("div1"),f.span_t("asdfasdf")}}if(m.isLocalDev)if(m.isRunningOnWebpackDevServer){let t=f.script_p(document.head,"/webpackEntryBundle.js");t.async=!1,t.defer=!1}else f.script_p(document.head,"http://localhost:4141/NetApps/cs/WebUIx/xCommonJS/tsLibX/pWebAppX/PageAutoReloader.js").type="module";else location.hostname.startsWith("beta");windowBag.serverSideBag=new class extends h{constructor(t){super(),this.storage=t}getNullable(t){if(!t)throw Error("Invalid arg [name], must not be blank");let e=t.toLowerCase(),r=this.storage[t];return void 0===r&&(r=this.storage[e]),console.info(`global_bag ${t}, ret=${r}`),r}}(windowBag.server_side_bag);class w{static formatparseISO8601(t){return Date.parse(t)}static formatLocaleDateString(t,e=""){if(null===t)return e;let r=t.toLocaleDateString();return"1/1/1"===r&&(r=""),r}static formatLocaleString(t,e=""){if(null===t)return e;let r=t.toLocaleString();return"1/1/1, 12:00:00 AM"===r&&(r=""),r}}class y{constructor(){this.strings=new Array,this.length=0}append(t){if(null==t)return;let e=t.toString();this.length+=e.length,this.strings.push(e)}appendFormat(t,...e){let r=l.format(t,...e);this.append(r)}prepend(t){if(t){let e=t.toString();this.length+=e.length,this.strings.unshift(e)}}prependLine(t){this.prepend("\n"),this.prepend(t)}appendLine(t){this.append(t),this.append("\n")}appendLineBR(t){this.append(t),this.append("<br>\n")}clear(){this.strings=[]}isEmpty(){return 0===this.strings.length}toString(){return this.strings.join("")}}class E{constructor(t){if(void 0===t)this.date=new Date;else if("number"==typeof t)this.date=new Date(t);else{if(!(t instanceof Date))throw Error("Invalid date: "+t);this.date=t}}}class b{static checkValidity(t,e="Date is not valid"){if(!this.isValid(t))throw Error(`${e}: "${t}"`)}static isValid(t){let e;return e="[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime()),e}static formatDateHHmm(t){let e="";if(t){let r;if(t instanceof Date?r=t:"string"==typeof t?r=new Date(Date.parse(t)):e=t+"??"+typeof t,r){let t={hour:"numeric",minute:"numeric",hour12:!1},n=Intl.DateTimeFormat("en-US",t).format(r);"24:00"===n&&(n="00:00"),e=r.toLocaleDateString()+" "+n}}return e}static GetQuarterLabel(t,e=!0){let r;if(1===t)r="first";else if(2===t)r="second";else if(3===t)r="third";else{if(4!==t)throw Error("Invalid quarter: "+t);r="fourth"}return e&&(r=r.charAt(0).toUpperCase()+r.slice(1)),r}toLocalDateTimeStr(){let t=new Date;t.toLocaleDateString(),t.toLocaleTimeString()}static Tests(){new Date,new Date,Date.now(),console.log("current date time",new Date)}static getTotalDays(t){return Math.round(t.getTime()/864e5)}static addDays(t,e){let r=t.toUTCString(),n=t.getTime(),i=new Date(n);return i.setDate(i.getDate()+e),console.log(`UTC: ${r} + ${e} days = ${i.toUTCString()}, newTimeMillis: ${n}`),i}static addUTCHours(t,e){let r=t.toUTCString(),n=t.getTime(),i=new Date(n);return i.setUTCHours(i.getUTCHours()+e),console.log(`UTC: ${r} + ${e} days = ${i.toUTCString()}, newTimeMillis: ${n}`),i}static getTimeString(t,e=!0){let r=new y;{let n=e?t.getUTCHours():t.getHours();n<10&&(0===n&&r.append("0"),r.append("0")),r.append(n)}{r.append(":");let e=t.getUTCMinutes();e<10&&(0===e&&r.append("0"),r.append("0")),r.append(e)}{r.append(":");let e=t.getUTCSeconds();e<10&&(0===e&&r.append("0"),r.append("0")),r.append(e)}return r.toString()}static DiffInWeeks(t,e){return(e.getTime()-t.getTime())/6048e5}static diffInMinutes(t,e){let r=e.getTime()-t.getTime();return Math.round(r/6e4)}static DiffInMonths(t,e){let r=t.getFullYear(),n=e.getFullYear(),i=t.getMonth();return e.getMonth()+12*n-(i+12*r)}}b.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};class v{static parseISO8601(t){if(t instanceof Date)return t;if(void 0===t)return null;if(null===t)return null;if("string"!=typeof t)throw Error(t+", val is not of string type, "+typeof t);let e=Date.parse(t);if(isNaN(e))throw Error("val is not a number (NaN): "+t);return new Date(e)}static parseDateTimeProperty_eg(t,e){let r=t[e];if(void 0===r)throw Error("No property found with name: "+e);if(null===r)return void console.log("val is null");if(""===r)return;if("string"!=typeof r)return;let n=Date.parse(r);if(!isNaN(n)){let t=new Date(n);console.log(t+" parsed date from str: "+r),r=t}t[e]=r}static parse_MM_DD_yyyy_hhmm(t){let e=(t=t.trim()).split(" "),r=e[0],n=e[1],i=r.split("/"),s=i[0],o=i[1],a=i[2],l=n.substring(0,2),c=n.substring(2),d=new Date(this.parseShort(a,"year"),this.parseShort(s,"month")-1,this.parseShort(o,"day"),this.parseShort(l,"hour"),this.parseShort(c,"minute"));if(!b.isValid(d))throw Error("invalid date: "+t);return d}static parseShort(t,e){return parseInt(t,10)}}class D{constructor(){this.a11y="Accessiblity"}static button(t,e){t instanceof Element&&t.setAttribute("role","button"),t instanceof Element&&t.setAttribute("aria-label",e)}static switch(t){t instanceof Element&&t.setAttribute("role","switch")}static search(t){t instanceof Element&&t.setAttribute("role","search")}static searchbox(t){t instanceof Element&&t.setAttribute("role","searchbox")}static cell(t){t instanceof Element&&t.setAttribute("role","cell")}static row(t){t instanceof Element&&t.setAttribute("role","row")}static rowheader(t){t instanceof Element&&t.setAttribute("role","rowheader")}static columnheader(t){t instanceof Element&&t.setAttribute("role","columnheader")}static table(t){t instanceof Element&&t.setAttribute("role","table")}static grid(t){t instanceof Element&&t.setAttribute("role","grid")}static gridcell(t){t instanceof Element&&t.setAttribute("role","gridcell")}static rowgroup(t){t instanceof Element&&t.setAttribute("role","rowgroup")}}class C{constructor(t="div"){this.currentRowIndex=-1,this.currentColumnIndex=-1,this.isAutoRowNumCell=!1,this.rowNumClassName="uninit",this.rowOddBackgroundColor="",this.rowEvenBackgroundColor="",this.maxRows=1e3,this.tab=document.createElement(t);let e=this.tab.style;"table"===t?(this.thead=document.createElement("thead"),this.tbody=document.createElement("tbody"),this.rowTagName="tr",this.cellTagName="td",D.table(this.tab)):(this.thead=document.createElement(t),this.tbody=document.createElement(t),this.rowTagName=t,this.cellTagName=t,e.border="1px solid #777",D.grid(this.tab)),this.tab.appendChild(this.thead),this.tab.appendChild(this.tbody),D.rowgroup(this.tbody),D.rowgroup(this.thead),this.appendNewLine(this.tab),this.rowSeperator=document.createTextNode("\n"),this.cellSeperator=document.createTextNode("\n  ")}get isOddRowNumber(){return this.currentRowIndex%2==0}get rowCount(){return this.currentRowIndex+1}setAutoRowNumCell(t,e="rowNum"){if(this.isAutoRowNumCell=t,this.rowNumClassName=e,this.currentColumnIndex>=0)throw Error("Invalid Operation, dataRows already started");if(this.headerRow)throw Error("Invalid Operation, headerRow already started")}getTableElement(){return this.tab}replaceTbody(t){this.tab.replaceChild(t,this.tbody)}setupRow(t,e=!1){let r=t.style;t instanceof HTMLDivElement&&(r.display="flex",r.flexWrap="wrap",e?(r.backgroundColor="#c3d3d3",r.paddingBottom="2px",r.fontWeight="bold"):(r.borderTop=this.tab.style.border,r.padding="5px 0px",this.currentRowIndex%2==0?r.backgroundColor=this.rowOddBackgroundColor:r.backgroundColor=this.rowEvenBackgroundColor))}addHeaderRow(...t){if(this.headerRow)throw Error("headerRow already exists");let e=document.createElement(this.rowTagName);D.row(e),this.headerRow=e,this.setupRow(e,!0),this.isAutoRowNumCell&&(this.addHeaderCell("#").className=this.rowNumClassName),this.thead.appendChild(e),this.rowSeperator&&this.tab.appendChild(this.rowSeperator.cloneNode(!0));for(let e=0;e<t.length;e++){let r=t[e];this.addHeaderCell(r)}return this.headerRow}getOrAddHeaderRow(){return this.headerRow||(this.headerRow=this.addHeaderRow()),this.headerRow}getHeaderRow(t=!0){if(!this.headerRow&&t)throw Error("headerRow does not exist");return this.headerRow}addDataRow(...t){if(this.currentRowIndex>this.maxRows)throw Error("too many rows, exceed: "+this.maxRows);let e=document.createElement(this.rowTagName);D.row(e),this.dataRow=e,this.setupRow(e),this.tbody.appendChild(e),this.rowSeperator&&this.tab.appendChild(this.rowSeperator.cloneNode(!0)),this.currentRowIndex++,this.currentColumnIndex=0,this.isAutoRowNumCell&&(this.addCell(this.currentRowIndex+1+"").className=this.rowNumClassName);for(let e=0;e<t.length;e++){let r=t[e];this.addCell(r)}return e}getOrAddDataRow(){return this.dataRow||(this.dataRow=this.addDataRow()),this.dataRow}addHeaderCell(t){let e=this.getOrAddHeaderRow(),r=this.createCell(t);return D.rowheader(r),e.appendChild(r),this.cellSeperator&&e.appendChild(this.cellSeperator.cloneNode(!0)),r}addCellLocaleDateString(t,e){let r=v.parseISO8601(t),n=w.formatLocaleDateString(r,"");return this.addCell(n,e)}addCellLocaleDateTimeString(t,e){let r=v.parseISO8601(t),n=w.formatLocaleString(r,"");return this.addCell(n,e)}addCell(t,e){let r=null,n=null;if(e)if(e instanceof HTMLElement)n=e;else{if("string"!=typeof e)throw Error("unknown type: "+Object.prototype.toString.call(e));r=e}let i=this.getOrAddDataRow(),s=this.createCell(t);return D.cell(s),i.appendChild(s),this.cellSeperator&&i.appendChild(this.cellSeperator.cloneNode(!0)),0===this.currentRowIndex&&n&&this.addHeaderCell(n),r||n&&(r=n.className),r&&(s.className=r),s}addRow(...t){return this.addDataRow(t)}createCell(t,e){let r;return void 0!==t?t instanceof Node?t instanceof HTMLAnchorElement?(r=document.createElement(this.cellTagName),r.appendChild(t)):r=t:(r=document.createElement(this.cellTagName),r.textContent=null===t?"":"string"==typeof t?t:t+""):r=document.createElement(this.cellTagName),e&&(r.className=e),r}toHtml(){return this.tab.outerHTML}appendNewLine(t){t.appendChild(document.createTextNode("\n"))}}(o=n||(n={}))[o.Unknown=0]="Unknown",o[o.Ready=1]="Ready",o[o.Running=2]="Running",o[o.Pausing=3]="Pausing",o[o.Resuming=4]="Resuming",o[o.Finished=5]="Finished";class S{constructor(t){this.elt=t,this.origStyleDecl=Object.assign({},t.style),this.style=this.elt.style,this.newProperties={}}switch(t,e){console.log(`settingNewCSS ${t}=${e}`),this.style.setProperty(t,e),this.newProperties[t]=e}switchStyles(t){let e=Object.getOwnPropertyNames(t);for(let r of e){if("number"==typeof r)continue;let e;e=t instanceof CSSStyleDeclaration?t.getPropertyValue(r):t[r],this.switch(r,e)}}reset(){this.switchBackToOrig()}switchBackToOrig(){let t=1,e=Object.keys(this.newProperties);0===e.length&&console.log("no css to switchback");for(let r of e){let e=this.origStyleDecl[r];console.log(`${t} settingBackCSS ${r}=${e}`),this.style.setProperty(r,e),t++}}toggle(){throw Error("Not implemented")}}class T extends Error{constructor(t,e=!1){super(t),this.handled=!1,this.level="Show Stopper",this.htmlMessage="err",this.handled=e,this.message=t+"",this.name="System Error",Config.isDebug&&console.error("MyError, error: ",this)}static isMyError(t){return t instanceof T}toString(){return`${this.message}`}}class x{constructor(t){t&&this.setParentContainer(t)}get buttonPaneElt(){if(!this._buttonPaneElt)throw Error("Invalid op, setParentContainer() needs to be called first");return this._buttonPaneElt}setParentContainer(t){console.log("parentContainer of ButtonPanel is: "+getTagNameIDClass(t));let e=qsNullable(".dialogx-button-pane",t);null===e&&(e=document.createElement("div"),e.className="dialogx-button-pane",t.appendChild(e)),this._buttonPaneElt=e}addButton(t,e){let r=document.createElement("button");return r.setAttribute("type","button"),r.innerHTML=t,e!==emptyFunc&&r.addEventListener("click",(t=>{void 0===e||e(t)})),this.buttonPaneElt.appendChild(r),r}addButtonSubmitPrimary(t,e){let r=this.addButton(t,e);return r.className="btnx btnx-primary",r.setAttribute("type","submit"),r}addButtonPrimary(t,e){let r=this.addButton(t,e);return r.className="btnx btnx-primary",r}addButtonDanger(t,e){let r=this.addButton(t,e);return r.className="btnx btnx-danger",r}addButtonWarning(t,e){let r=this.addButton(t,e);return r.className="btnx btnx-warning",r}addButtonInfo(t,e){let r=this.addButton(t,e);return r.className="btnx btnx-info",r}getButton(t){if(!t.startsWith("."))throw Error("btnSelector must start with a period (.) for className");let e=qsNullable(t,this.buttonPaneElt);if(null===e){let e="";throw this.getButtons().forEach((t=>{e+="[."+t.className+"], "})),Error(`no button found for selector ${t}, available buttons are: ${e}`)}return e}getButtons(){let t=[];return this.buttonPaneElt.querySelectorAll("button").forEach((e=>{t.push(e)})),t}clearButtons(){this.buttonPaneElt.innerHTML=""}hide(){this.buttonPaneElt.style.display="none"}}class L{static getNextZIndex(){return(this.currentZIndex++).toString()}static generateUniqueID(t){let e;return e=t?t+this.currentUniqueID++:"uid"+this.currentUniqueID++,e+="_generated",e}static scrollToBottom(){const t=document.scrollingElement||document.body;t.scrollTop=t.scrollHeight,t.scrollLeft=t.scrollWidth}static fixElementsForActivity(t,e){console.log("fixElementsForActivity: "+t),t=t.toLocaleLowerCase();let r=qsAll("[data-if-activities]",e);for(let e of r){let r,n=e.dataset.ifActivities;void 0!==n&&(n=n.replace(/[ ]+/,","),n=n.toLocaleLowerCase(),n=","+n+",",r=!(0===n.length||n.includes(",*,")||!n.includes(",!"+t+",")&&(n.includes("!")||n.includes(","+t+","))),r?(console.log("removing elt: "+e.className+", data-if-activities="+n),e.remove()):console.log("NOT removing elt: "+e.className+", data-if-activities="+n))}}addchildToRoot(t,e,r){let n=document.createElement(t);return n.classList.add(e),r.appendChild(n),n}}L.currentZIndex=111,L.currentUniqueID=1;class I{constructor(t){this.showCloseButton=!1,this.dialogEvents=t;let e={},r=0,n=0,i=this;e={draggable:!1,resizable:!1,closeOnEscape:!0,autoOpen:!1,modal:!0},e.hide={effect:"fade",duration:300},e.create=function(t){console.log("jqDialog created, should be once only"),i.dialogEvents.fireEvent("create")},e.open=function(){console.log("jqDialog open..... openCount: "+ ++r),i.dialogEvents.fireEvent("open")},e.beforeClose=function(t,e){console.log("jqDialog beforeClose: "+ ++n),i.dialogEvents.fireEvent("beforeClose")},e.close=function(t,e){console.log("jqDialog close..... closeCount: "+ ++n),i.dialogEvents.fireEvent("close")},this.jqDialogOptions=e,this.jqDialogOptions.width="801px"}}class N{constructor(t,...e){this.eventHandlerList=[],this.validEvents=e,this.eventOwner=t}checkEventName(t){if(!this.validEvents.includes(t))throw Error("invalid event: "+t+", validEvents="+this.validEvents.join(","))}getEventNames(){if(0===this.eventHandlerList.length)return"No handlers found for any event.";{let t="";for(let e=0;e<this.eventHandlerList.length;e++)t+=", eventName: "+this.eventHandlerList[e].name;return t}}addEventHandlerForMultipleEvents(t,e,r){t.forEach((t=>{this.addEventHandler(t,e,r)}))}addEventHandler(t,e,r){this.checkEventName(t);let n={name:t,handlerID:r=r||"default",handler:e};if(0!==this.getEventHandlers(t,r).length)throw Error("event already added: "+t+", handlerID: "+r);console.log("adding eventListener fo event: "+t),this.eventHandlerList.push(n)}getEventHandlers(t,e){let r=[];return this.eventHandlerList.forEach((n=>{0===n.name.localeCompare(t,void 0,{sensitivity:"base"})&&(e?0===n.handlerID.localeCompare(e,void 0,{sensitivity:"base"})&&r.push(n):r.push(n))})),r}async fireEvent(t,e){console.log("firing event: "+t+", args=",e),this.checkEventName(t);let r=this.getEventHandlers(t);if(void 0===r)console.log(t+" fired, no handlers found for this eventName, allEvents="+this.getEventNames());else for(let t of r){let r=t.handler;await r(e,e)}}removeEventListener(t,e,r){}clear(){this.eventHandlerList=[]}}class A{constructor(t){this.jqDialog=uninit,this.titleBarElt=uninit,this.dialogElt=uninit,this.mainElt=uninit,this.contentElt=uninit,this.isDestroyed=!1,t=null!=t?t:A.createJQueryDialogOptions(),this.dialogEvents=t.dialogEvents;let e=document.querySelectorAll("div.ui-dialog").length;if(e>20)throw Error("Too many dialogs exist: "+e);this.mainElt=document.createElement("div"),this.contentElt=document.createElement("div"),this.mainElt.appendChild(this.contentElt),this.jqDialog=jQuery(this.mainElt).dialog(t.jqDialogOptions),this.dialogElt=qsClosest(".ui-dialog",this.mainElt),this.dialogElt.classList.add("my-form-dialog"),this.titleBarElt=qs(".ui-dialog-titlebar",this.dialogElt),t.showMaximizeButton?this.convertCloseButtonToMaximizeButton():t.showCloseButton||this.removeCloseButton(),windowBag.de=this.dialogElt}static createJQueryDialogOptions(){let t=new N(this,"create","open","beforeClose","close");return new I(t)}removeCloseButton(){qs("button",this.titleBarElt).remove()}convertCloseButtonToMaximizeButton(){let t=qs("button",this.titleBarElt);if(null!=t.parentNode){let e=t.cloneNode(!0);e.innerHTML="Maximize",e.onclick=t=>{this.dialogElt.style.width="200%",this.dialogElt.style.left="0px"},t.parentNode.replaceChild(e,t)}}setDestroyOnClose(t=!0){t?this.jqDialog.on("dialogclose",(()=>{this.destroy(),this.isDestroyed=!0})):this.jqDialog.on("dialogclose",(()=>{}))}getTitleBarElt(){return this.titleBarElt}set setTitle(t){qs(".ui-dialog-title",this.titleBarElt).innerHTML=t}showModal(){this.jqDialog.dialog("open"),this.dialogElt.style.zIndex=L.getNextZIndex().toString()}hide(){this.jqDialog.dialog("close")}close(t){this.jqDialog.dialog("close")}destroy(){this.jqDialog.dialog("destroy")}}class R extends A{constructor(t){super(t),this.buttonPane=new x}setContent(t,e=!1){"string"==typeof t?this.mainElt.innerHTML=t:(this.mainElt.innerHTML="",this.mainElt.appendChild(t)),this.buttonPane.setParentContainer(this.mainElt),e&&(qs("form",this.mainElt).method="dialog")}}class B{static questionAnswer(t){return this.buildIcon("fas fa-question-circle",t)}static info(t){return this.buildIcon("fas fa-info-circle",t)}static error(t){return this.buildIcon("fas fa-exclamation-circle",t)}static warn(t){return this.buildIcon("fas fa-exclamation-triangle",t)}static ban(t){return this.buildIcon("fas fa-ban",t)}static check(t){return this.buildIcon("fas fa-check",t)}static info_letterI_z(t){return this.buildIcon("fas fa-info",t)}static plus(t){return this.buildIcon("fas fa-plus",t)}static edit(t){return this.buildIcon("fas fa-edit",t)}static arrowBackiOS(t){return this.buildIcon("arrow_back_ios",t)}static arrowLeft(t){return this.buildIcon("arrow_left",t)}static arrowRight(t){return this.buildIcon("arrow_right",t)}static createEl(t){let e=document.createElement("span");return e.innerHTML=t,e}static buildIcon(t,e){let r;return r=t.startsWith("fas")||t.startsWith("fab")?`<i class='${t}'></i>`:`<i class='material-icons'>${t}</i>`,e&&(r+=" "+this.encodeHTML(e)),r}static encodeHTML(t){let e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML}static decode(t){let e=document.createElement("textarea");return e.innerHTML=t,e.value}}class O{static newDialog(t,e,r){"string"==typeof t&&(t="<br>"+(t+="&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"),t+="<br>",t+="<br>");let n=R.createJQueryDialogOptions();n.jqDialogOptions.width="auto";let i=new R(n);return i.mainElt.style.fontSize="1.2em",i.getTitleBarElt().style.backgroundColor=r,i.setDestroyOnClose(),i.setTitle=e,i.setContent(t),i}static showAlert(t,e="Alert",r="Close"){e=this.fixTitle("&#x26A0;",e);let n=this.newDialog(t,e,"lightsalmon"),i=new Promise(((t,e)=>{n.buttonPane.addButtonWarning(r,(()=>{n.close(r)})),n.dialogEvents.addEventHandler("close",(e=>{console.log("MessageBox closed, returnVal="+e),t(e)}))}));return n.showModal(),i}static showConfirm(t,e="OK",r="",n="Please confirm"){return this.showConfirm_withBgColor("lightsteelblue",t,e,r,n)}static showConfirm_withBgColor(t,e,r,n,i){n||(n=this.NegativeButtonDefaultInnerHtml),i=this.fixTitle("&quest;",i);let s=this.newDialog(e,i,t);r=B.check(r);let o=new Promise(((t,e)=>{s.buttonPane.addButtonInfo(r,(()=>{t(!0),s.close()})),s.buttonPane.addButtonInfo(n,(()=>{t(!1),s.close()})),s.dialogEvents.addEventHandler("close",(()=>{t()}))}));return s.showModal(),o}static showConfirmWarning(t,e="OK",r="",n="Please confirm"){return this.showConfirm_withBgColor("lightsalmon",t,e,r,n)}static showInfo(t,e="Info",r="OK"){e=this.fixTitle("&#x1F6C8;",e);let n=this.newDialog(t,e,"lightsteelblue"),i=new Promise(((t,e)=>{n.buttonPane.addButtonInfo(r,(()=>{n.hide(),t()})),n.dialogEvents.addEventHandler("close",(()=>{t()}))}));return n.showModal(),i}static ensureDocumentClickListenerRegistered(){this.registerDocumentClickListenerDone||(this.registerDocumentClickListenerDone=!0,document.addEventListener("click",(t=>{let e=t.target;if(console.log("mesgbox:document.clicked event",t),null===e.closest("[role=dialog]")&&null!==this.popupDialog)try{console.log("mesgbox:document.clicked event, closing popup",t),this.popupDialog.hide()}catch{}})))}static showPopupCloseOnDocumentClick(t,e="Info",r="Close"){e=B.info(e);let n=this.newDialog(t,e,"lightsteelblue");this.popupDialog=n;let i=new Promise(((t,e)=>{n.buttonPane.addButtonInfo(r,(()=>{this.popupDialog=null,n.hide(),t()})),n.dialogEvents.addEventHandler("close",(()=>{this.popupDialog=null,t()}))}));return this.ensureDocumentClickListenerRegistered(),n.showModal(),i}static async showResourceAtUrl(t,e){let r=await z.fetchText(t);e&&(r=e(r));let n=t,i=this.newDialog(r,n,"lightsteelblue");return i.buttonPane.addButtonWarning("Close",(()=>{i.hide()})),i.showModal(),i}static showSystemError(t,e="Error",r="Close"){if(console.error(t),!t)throw Error("Invalid arg: err is null");if((t instanceof String||t.startsWith)&&(t=new Error(t)),!(t instanceof Error)){if(!t.message)throw Error("arg err must be of type Error, not: "+typeof t);t=new Error(t.message)}let n=t;e.toLowerCase().startsWith("error")||(e="Error: "+e);let i=t.message;t.stack&&(i="<pre>"+t.stack+"</pre>"),n.htmlMessage&&(i+=n.htmlMessage);let s=this.newDialog(i,e,"indianred");n.handled=!0,s.dialogElt.style.minWidth="1000px";let o=new Promise(((t,e)=>{s.buttonPane.addButtonDanger(r,(()=>{s.hide(),t()})),s.dialogEvents.addEventHandler("close",(()=>{t()}))}));return s.showModal(),o}static showUserError(t,e,r="Close"){let n=new T(t);e||(e="Error"),e.toLowerCase().startsWith("error")||(e="Error: "+e),e=this.fixTitle("&#x2298",e),console.warn(n);let i=this.newDialog(t,e,"indianred"),s=new Promise(((t,e)=>{i.buttonPane.addButtonDanger(r,(()=>{i.hide(),t()})),i.dialogEvents.addEventHandler("close",(()=>{t()}))}));return i.showModal(),s}static showPrompt(t,e="Please Respond:",r="OK"){let n=document.createElement("div");n.appendChild(document.createTextNode(t)),n.appendChild(document.createElement("br"));let i=document.createElement("input");i.className="ff-control",i.required=!0;let s=i.style;s.width="95%",s.marginTop="5px",n.appendChild(i);let o=this.newDialog(n,e,"lightsteelblue"),a=new Promise(((t,e)=>{let n=()=>{let e=i.value;o.hide(),t(e)},s=o.buttonPane.addButtonPrimary(r,n);s.disabled=!0,i.addEventListener("keyup",(t=>{i.value.trim().length>0?(s.disabled=!1,t.preventDefault(),"Enter"===t.key&&n()):s.disabled=!0})),o.buttonPane.addButtonInfo("Cancel",(()=>{o.hide(),t()})),o.dialogEvents.addEventHandler("close",(()=>{t()}))}));return o.showModal(),a}static fixTitle(t,e){let r=document.createElement("span");return r.innerHTML=t,r.style.fontWeight="bold",r.style.fontSize="30pt",r.style.fontSize="20pt",r.outerHTML+" "+e}}O.NegativeButtonDefaultInnerHtml=B.ban("Cancel"),O.popupDialog=null,O.registerDocumentClickListenerDone=!1,windowBag.ModalBox_showAlert=function(t){O.showAlert(t)};class P{constructor(t){t instanceof Element&&(t=t.dataset),this.ds=t,this.stringified=JSON.stringify(t)}getIntOrShowErrz(t,e){try{return this.getInt(t)}catch(t){console.error("getInt",t);let e=new T(t);throw O.showSystemError(e,"getInt failed"),e}}getKeyId(t){return this.getInt("keyId",t)}getInt(t,e){let r="",n=-999;if(void 0===e?r=this.get(t):(r=this.get(t,null),null===r&&(n=e)),null!==r&&(n=parseInt(r,10),isNaN(n)))throw Error(`dataset.${t} is not a number: ${r}`);return n}get(t,e){if(!t)throw Error("argument [key] is empty");let r=this.ds[t],n="??";if(void 0===r?n=`dataset.${t} is not found in `+this.stringified:null===r&&(n=`dataset.${t} is null in `+this.stringified),r&&(r=r.trim(),""===r&&(n=`dataset.${t} is blank `+this.stringified)),!r){if(void 0===e)throw Error(n);r=e}return r}}class H{constructor(t,e){this.elt=t,this.propertyName=e}static createNew(){return document.createElement("div").style}setWaitCusor(){}static showProperties(t){let e=t.style,r=Object.assign({},e);console.log({s3:r}),console.log(JSON.stringify(r));let n=Object.getOwnPropertyNames(r);console.log({propNames:n}),console.log("color",e.getPropertyValue("color"));let i=window.getComputedStyle(t);console.log("color",i.getPropertyValue("color"))}static getStyleDeclaration(t,e,r){r||(r=`No css Rule found for selectorText: ${t} in style element with id: ${e.id}`);let n=class{static devicePixelRatio(){let t=`(resolution: ${window.devicePixelRatio}dppx)`;const e=()=>{let t=window.devicePixelRatio,e=(100*t).toFixed(0);qs(".pixel-ratio").innerText=`${e}% (${t.toFixed(2)})`};e(),window.matchMedia(t).addEventListener("change",e)}static getStyleRule(t,e,r){r||(r=`No css Rule found for selectorText: ${t} in style element with id: ${e.id}`);let n=this.getStyleRuleNullable(t,e,r);if(null===n)throw"never";return n}static getStyleRuleNullable(t,e,r){let n=e.sheet.cssRules,i=null;for(let e=0;e<n.length;e++){let r=n[e];if(r.type===CSSRule.STYLE_RULE){let e=r,n=(e.cssText,e.selectorText);if(n.includes(",")){let r=n.split(/\s*,\s*/);for(let n=0;n<r.length;n++)if(r[n]===t){i=e;break}}else if(n===t){i=e;break}}}if(null===i&&void 0!==r)throw Error(r);return i}static test1(){m.isLocalDev&&qsAll(".localDevOnly").forEach((t=>{t.style.display="block",t.style.display="block !important",t.style.setProperty("display","block","important")}))}}.getStyleRuleNullable(t,e,r);if(null===n)throw"never";return n.style}static setPropertySaveOrig(t,e,r){this.saveProperty(t,e),t.style.setProperty(e,r)}static saveProperty(t,e){let r=t.style.getPropertyValue(e);null===new P(t.dataset).get(e,null)&&(t.dataset[e]=r)}static resetPropertyToOrig(t,e){let r=new P(t.dataset).get(e,null);null!=r&&t.style.setProperty(e,r)}}class M{constructor(){this.method=uninit,this.keyID=uninit,this.exception=uninit,this.sqlStatements=uninit,this.debugInfo=uninit,this.totalRowCount=uninit,this.pageIndex=uninit,this.payload=uninit,this.payloadType=uninit,this.apiVersion=uninit}get isPayloadJSON(){return"json"===this.payloadType}get isPayloadHTML(){return"html"===this.payloadType}get isPayloadUserError(){return"usererror"===this.payloadType}get isPayloadException(){return"exception"===this.payloadType}static getErrorInfoShort(t){let e=new y;return e.appendLineBR(t.payload),e.appendLineBR(t.sqlStatements),e.appendLineBR(`payloadType: ${t.payloadType}`),e.toString()}static assignFrom(t){if("string"==typeof t){const e="src must not of string type";throw console.error(e,t),Error(e)}let e=new M;if(Object.assign(e,t),!e.payloadType){const e="payloadType cannot be null or blank";throw console.error(e,t),Error(e)}if(e.payloadType=e.payloadType.toLowerCase(),!this.validPayloadTypes.includes(e.payloadType)){let r="Invalid payloadType: "+e.payloadType+" , valid types="+this.validPayloadTypes.join(",");throw console.error(r,e,t),Error(r)}return e}}M.validPayloadTypes=["json","html","plaintext","usererror","syserror","exception"];class k{constructor(){this.count=0,this.lbCounterElt=uninit}run(){if(alreadyExecuted("DevDisplayCount.run"))return;0===this.count&&console.log("DisplayCount starts running");let t=this.lbCounterElt,e=this.count;t===uninit&&(t=document.createElement("span"),t.className="clsDisplayCount",document.body.appendChild(t),t.addEventListener("click",(()=>{G.showServerDebugInfo()})));let r=(e<10?"0":"")+e;r+=", Elts:"+document.querySelectorAll("*").length,r+=", jqDialogs:"+document.querySelectorAll("div.ui-dialog").length,t.textContent=r,setTimeout((()=>{this.run()}),0===e?200:1e3),e++,e>600&&(e=1),this.lbCounterElt=t,this.count=e}}class F{static isOfType(t,e){if(!(t instanceof e))throw Error(`Expected type ${e}, but received ${typeof t}`)}static functionExists(t,e,r){if(!(t in e)){let n=`function '${t}' doesn't exist in obj: ${e}, mesg=${r}`;throw console.error(n,e),Error(n)}{let n=e[t];if("function"!=typeof n){let i=`'${t}' of type ${typeof n} is not a function in obj: ${e}, mesg=${r}`;throw console.error(i,e),Error(i)}}}static isString(t){if("string"!=typeof t)throw Error("Not a string!")}static isDefined(t){if(null==t)throw Error(`Expected 'val' to be defined, but received ${t}`)}static assertTests(){F.isString(2),2..toLocaleLowerCase()}static isTrue(t,e){t||this.throwError("isTrue",t,e)}static isTruthyTest(t,e){t||this.throwError("true",t,e)}static isTruthy(t,e){t||this.throwError("true",t,e)}static isFalsy(t,e){t&&this.throwError("isFalsy",t,e)}static isGreaterThan(t,e,r){this.isTruthy(t>e,r)}static isLessThan(t,e,r){this.isTruthy(t<e,r)}static areEqual(t,e,r){if(t!==e)throw Error(r)}static areStrictlyEqual(t,e,r){if(t!==e)throw Error(r)}static areSame(t,e,r){if(!Object.is(t,e))throw Error(r)}static areNotSame(t,e,r){if(!Object.is(t,e))throw Error(r)}static isNull(t){if(null!==t)throw Error("null")}static isNotNull(t){if(null===t)throw Error("null")}static isPositive(t,e){(!t||t<=0)&&this.throwError("isPositive",t,e)}static isNegative(t,e){(!t||t>=0)&&this.throwError("isNegative",t,e)}static throwError(t,e,r){let n="";throw r&&(n+=r+". "),n+="Assert failed, expected: "+t+", actual: "+e,console.error(n),console.trace(n),new Error(n)}}class _{static buildURLSearchPart(t,e=!0){let r=new y,n=0;e&&r.append("?"),F.functionExists("entries",t,"buildURL");let i=t.entries();for(let t of i){let e=t[0],i=t[1];if(n>0&&r.append("&"),r.append(e),r.append("="),i instanceof File){let t="cannot build URLSearchPart from File, key="+e;throw console.error(t),Error(t)}let s=encodeURIComponent(i).replace(/%20/g,"+");r.append(s),n++}return r.toString()}static containsFileEntries(t){if(TrueTodo)throw"unimplemented";if(TrueTodo)return!1;F.functionExists("entries",t,"containsFile");for(let e of t.entries())if(e[0],e[1]instanceof File)return!0;return!1}static toObject(t){let e={};return t.forEach((function(t,r){e[r]=t})),e}static toStr(t,e=!1){const r=new y;try{let n=0;for(let e of t.entries())r.appendLine(`${n+1} ${e[0]}: ${e[1]}`),n++;r.prependLine("#OfEntries: "+n);const i=r.toString();return e&&console.log("FormData.toStr",t,i),i}catch(t){return"MS.Edge issue:"+t}}static GetSampleFormData(){const t=new FormData;t.append("username","Groucho"),t.append("accountnum","123456");const e=new Blob(['<a id="a"><b id="b">hey!</b></a>'],{type:"text/xml"});return t.append("webmasterfile",e),t}static fromObject2(t,e,r=""){for(let n in t){if(!t.hasOwnProperty(n)||void 0===t[n])continue;let i=r?`${r}[${n}]`:n;t[n]instanceof Date||(t[n]instanceof Array?t[n].forEach(((t,r)=>{"object"!=typeof t&&e.append(`${i}[]`,t)})):("object"!=typeof t[n]||t[n]instanceof File)&&e.append(i,t[n].toString()))}return e}static fromObject3(t,e,r){const n=new FormData;return function t(e,i=""){if(!function(t){return Array.isArray(r)&&r.some((function(e){return e===t}))}(i))if(i=i||"",e instanceof File)n.append(i,e);else if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r],i+"["+r+"]");else if("object"==typeof e&&e)for(const r in e)e.hasOwnProperty(r)&&t(e[r],""===i?r:i+"."+r);else null!=e&&n.append(i,e)}(t,e),n}}class ${constructor(){this.reqInit=$.createRequestInit(),this.headers=new Headers}static createRequestInit(){return{method:"uninit"}}async dispatchReturningJSON(t,e,r){let n=await this.dispatch(t,e,r),i=n.headers.get("content-type")+"";if(i.includes("application/json"))return db&&console.log("response is json"),n.json();throw n.text().then((t=>{db&&console.error("response text: ",t)})),Error("Response is not json2: "+i)}async get(t){return this.dispatch("GET",t)}async dispatch(t,e,r){if(r&&"POST"!==t)throw Error("method must be POST to send formData");this.reqInit.method=t,this.reqInit.body=void 0,r&&(this.reqInit.body=r,db&&console.log("Posting FormData",_.toStr(this.reqInit.body)),windowExtBag.formDataSubmitted=r);const n=new Request(e,this.reqInit);return db&&console.log("start fetchin...",{url:e,req:n}),fetch(n).then((t=>{if(db&&console.log("fetchResponse received:",t),t.ok){if(!t.headers.get("content-type"))throw Error(`unknown respond content type for url ${e}`);return t}{let r=new T(`probably no-cors, url=${e}, httpStatusText=${t.statusText}`);throw r.htmlMessage+=`<br><br>url: <a href='${e}' target='_error'> ${e}</a>`,console.trace("DataApiDispatcher.fetch.response.NotOK",r),console.error("DataApiDispatcher.fetch.response.NotOK",t),r}})).catch((t=>{throw O.showAlert("aa"),new Error("aa")}))}}class U{static fromObject(t){return new Map(Object.entries(t))}static toStr(t){let e=new y;return t.forEach(((t,r)=>{e.appendLine(`[${r}]=[${t}]`)})),e.toString()}static lowercaseKeys(t){let e=new Map;return t.forEach(((t,r)=>{let n=r.toLowerCase();e.set(n,t)})),e}static getStringCI(t,e){t=t.toLowerCase(),e.forEach(((e,r)=>{t=e}))}}class q{async dispatchReturningJSON(t,e,r){let n=await this.dispatch(t,e,r),i=n.responseType;if(i&&"json"!==i){let t="XMLHttpRequestX, Response is not json1: ["+i+"]<br>";throw console.error(t,n),Error(t)}let s=n.response;return JSON.parse(s)}get(t){return this.dispatch("GET",t)}dispatch(t,e,r){if(db&&console.log("XML Http Req url="+e),r&&"POST"!==t)throw Error("method must be POST to send formData");return new Promise(((n,i)=>{let s=new XMLHttpRequest;s.onload=()=>{if(200!==s.status){db&&console.error("err: response not OK, failed to fetch url="+e,s);let t=new T(`url=${e} (${s.status}: ${s.statusText})`);t.htmlMessage+=`<br><br>url: <a href='${e}' target='_error'> ${e}</a>`,console.trace("DataApiDispatcher.fetch.response.NotOK",t),i(t)}else{let t=this.getHeaders(s);if(t=U.lowercaseKeys(t),!t.get("content-type")){let r=`unknown respond content type for url ${e}, map=`+U.toStr(t);throw console.error(r,t),Error(r)}n(s)}},s.onerror=t=>{console.error("XMLHttpRequestX.onerror: ",t),i(t)},s.open(t,e,!0),r?(windowExtBag.formData=r,s.send(r)):s.send()}))}getHeaders(t){let e=t.getAllResponseHeaders(),r=new Map;return m.isDebug&&console.log("parsin headers: "+e),e.split("\r\n").forEach((t=>{if(t){let[e,n]=t.split(": ");try{r.set(e,n)}catch(t){let r=`fail to append, name=[${e}], value = [${n}]`;console.warn(r,t)}}})),r}static arrayBufferToBase64String(t){let e="",r=new Uint8Array(t);for(let t=0;t<r.byteLength;t++){let n=r[t];e+=String.fromCharCode(n)}return window.btoa(e)}}class z{static async fetchText(t){let e;return e=False?(new q).get(t).then((t=>t.responseText)).catch((function(e){let r="fetch failed for url: "+t+", err="+e;throw O.showAlert(r),Error(r)})):(new $).get(t).then((t=>t.text())),e}static async fetchHtml_toHTMLElementSelector(t,e){let r=qs(t);try{let t=await z.fetchText(e);return r.innerHTML=t,r}catch(t){let r="fetch failed for url: "+e;throw await O.showAlert(r),Error(r)}}static async fetchHtmlCreateElement(t,e){void 0===e&&(e="div");let r=document.createElement(e);r.dataset.resourceFetched=t;let n=await z.fetchText(t);return r.innerHTML=n,r}static async loadImageBlob(t,e){return(new $).get(e).then((function(t){return t.blob()})).then((function(e){O.showAlert("ddd");let r=URL.createObjectURL(e);t.src=r})).catch((function(t){let r="fetch failed for img url: "+e+", err="+t;throw O.showAlert("ddd"),Error(r)}))}}class j{static test1(){}static setExpiresByDays(t,e,r){let n=(new Date).getTime()+24*r*60*60*1e3;new Date(n)}static setValue(t,e,r,n,i){let s=encodeURIComponent(t)+"="+encodeURIComponent(e);if(r){let t="";switch(r.constructor){case Number:t=r===1/0?"expires=Fri, 31 Dec 9999 23:59:59 GMT":"max-age="+r;break;case String:t="expires="+r;break;case Date:t="expires="+r.toUTCString()}s+="; "+t}return n&&(s+="; path="+n),document.cookie=s,s}static containsKey(t){return null!==this.getValue(t)}static getValue(t){let e=escape(t)+"=",r=document.cookie.split(";"),n=null;for(let t=0;t<r.length;t++){let i=r[t];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(i.startsWith(e)){let t=i.substring(e.length,i.length);n=decodeURIComponent(t);break}}return n}static remove(t,e,r){this.setValue(t,"",-1,e,r)}}class W{static get username(){return W._username}static get userRoles(){return W._userRoles}static userHasRole(t){if(!this.userRoles)throw Error("userRoles not set");if(!t)throw Error("Invalid arg: "+t);return this.userRoles.includes(t)}static get _hasRoleSuperuserPure(){return this.userHasRole("superuser")}static get hasRoleSuperuser(){let t=this.userHasRole("superuser");return(location.href.includes("zzadminonly")||location.href.includes("zzreadonly"))&&(t=!1),t}static get _hasRoleAdminOrHigherPure(){return this.userHasRole("admin")||this._hasRoleSuperuserPure}static get hasRoleAdminOrHigher(){let t=this.userHasRole("admin")||this._hasRoleSuperuserPure;return this._hasRoleSuperuserPure&&location.href.includes("zzadminonly")?t=!0:location.href.includes("zzreadonly")&&(t=!1),t}static get hasRoleAdminOnly(){let t=this.userHasRole("admin")&&!this._hasRoleSuperuserPure;return this._hasRoleSuperuserPure&&location.href.includes("zzadminonly")?t=!0:location.href.includes("zzreadonly")&&(t=!1),t}static get hasRoleReadOrHigher(){let t=this.userHasRole("readonly")||this._hasRoleAdminOrHigherPure;return this._hasRoleAdminOrHigherPure&&location.href.includes("zzreadonly")&&(t=!0),t}static get hasRoleReadOnly(){let t=this.userHasRole("readonly")&&!this._hasRoleAdminOrHigherPure;return this._hasRoleAdminOrHigherPure&&location.href.includes("zzreadonly")&&(t=!0),t}static get anonymousUserID(){{let t="auid",e=j.getValue(t);return null===e&&(e="",j.setValue(t,e,1/0)),e}}}W._username="",W._userRoles="";class V{static get username(){return W.username}static get userRoles(){return W.userRoles}static get dbEnv(){return m._dbEnv}static get isDbProd(){return m.isDbProd}static newDataApiClient(t=""){const e=this.getDataApiUrl(t);return new tt(e)}static getDataApiUrl(t){return m.DataApiUrlBase+t}}class K{static async init(){if(alreadyExecuted("DevHelpPage.init"))return;if(!this.isInitDevPage)return;let t="uninit";try{t=await z.fetchText("DevHelpPage.htm")}catch(t){return void console.warn(t+"Not found",t)}let e=document.createElement("div");e.innerHTML=t,this.helpDiv=e,this.setupSidebarDevLinks();let r=qs("#devUrls",e),n=(r.textContent+"").split(/\s/),i=(document.createDocumentFragment(),document.createElement("ol"));n.forEach((t=>{if(t=t.trim()){let e=document.createElement("a");e.textContent=t,e.href=t,e.target="win2";let r=document.createElement("li");r.appendChild(e),i.appendChild(r)}})),r.innerHTML="",r.appendChild(i)}static async showHelpPageDialog(){await O.showInfo(this.helpDiv)}static setupSidebarDevLinks(){location.href;let t=location.href.toLowerCase(),e=document.createElement("ul"),r=function(t,r,n){let i=document.createElement("a");i.href=t||"unset",i.textContent=r,n&&(i.className=n);let s=document.createElement("li");return s.appendChild(i),e.appendChild(s),i};r("#",""),r("?zz-test","unit test"),r("?z","zzRunAllTests1","RunAllTests"),r("?zz-db=1","debug on"),r("?zz-db=0","debug off"),r("?zz-dialogs","test dialogs"),r("?zz-libtest","test lib");let n=m.appName.toLowerCase()+"- ";r("http://localhost:2040/PubAppz/WebUI"+location.pathname+location.search,n+"LocalIIS"),r(this.remoteDevURL,n+"RemoteDev"),r(this.QAURL,n+"QA"),r(this.ProductionURL,n+"Production"),r("","zzhelp DevHelpPage.htm").addEventListener("click",(async t=>{t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.showHelpPageDialog()})),r("?zzShowDebug","zzShowDebug").addEventListener("click",(async t=>{t.preventDefault(),G.showServerDebugInfo()})),t.includes("zzshowdebug")&&G.showServerDebugInfo(),r(V.getDataApiUrl("Dx"),"Dx (new window)").target="dx",r("/cs/WebUI/app/shared/links.html","links"),r("/cs/WebUI/EmpRating/csat.html?ap=HND&eno=68666&ename=First%20Last","app- EmployeeRating"),r("/cs/WebUI/CMS/CMS.html","app- CMS"),r("/cs/WebUI/FsWeb/FsWeb.html","app- FsWeb"),r("#",""),r("/cs/WebUI/REAMS/reams.html","app- REAMS"),r("/cs/WebUI/GARS/HND.html","app- GARS"),r("/cs/WebUI/RFP/RfpAdmin.html?page=Purchasing","app- RFP"),r("/cs/WebUI/LASAdmin/Lasa.html?page=LocusLabsData","app- Lasa/Maps"),r("/cs/WebUI/ImageGallery/LAS.html","app- ImageGallery-LAS"),r("/cs/WebUI/ImageGallery/VGT.html?year=2018&zzuse","app- ImageGallery-VGT"),r("/cs/WebUI/GaFids/VGT.html","app- GaFids"),r("/cs/WebUI/PubSites/Maps/maps.html","Maps");let i=qs("#sidebarDevLinks",this.helpDiv);i.innerHTML=i.innerHTML.replace(/\{apiRootUrl\}/g,m.DataApiUrlRoot),qsMany("a",1,1e3,i).forEach((t=>{let r=t;r.setAttribute("rel","nofollow noopener noreferrer");let n=r.textContent+"";n=n.trim(),""===n&&(r.textContent=r.href);let i=document.createElement("li");i.appendChild(r),e.prepend(i)}));let s=document.createElement("details"),o=document.createElement("summary");o.textContent="DevLinks",s.appendChild(o),s.appendChild(e),class{static setupOpenCloseState_HLS(t,e){let r=new u(e+"-isOpen");t.addEventListener("toggle",(e=>{t.open?r.setItem("true"):r.setItem("false")})),"true"===r.getItemOrDefault("false")&&t.setAttribute("open","")}}.setupOpenCloseState_HLS(s,"devLinks");let a=s;a.className="sideBarDevLinks",null!==qsNullable("."+a.className)&&O.showSystemError("."+a.className+" elt already existed"),document.body.appendChild(a)}}K.isInitDevPage=!1;class G{static async RunDevTasks(){alreadyExecuted("RunDevTasks")||Config.isLocalDebug&&((new k).run(),await K.init())}static setStatusTopRight(t){let e=this.setStatus(t);if(e){let t=e.style;t.top="30px",t.right="3px",t.bottom="",t.left=""}}static setStatus(t){let e=null;if(False){console.log(t);let r="obFieldz",n=qsNullable("#"+r);if(null===n){n=document.createElement("div"),n.id=r;let t=n.style;t.position="fixed",t.zIndex="99123",t.backgroundColor="lightyellow",t.color="black",t.bottom="25px",document.body.insertBefore(n,document.body.firstElementChild)}n.textContent=t,e=n}return e}static getSampleSize(){let t=new URLSearchParams(location.search.toLowerCase()).get("zzsample"),e=-1;return t&&(e=parseInt(t,10)),e}static isZzThrow(){return null!==new URLSearchParams(location.search.toLowerCase()).get("zzthrow")}static processEnvTags(){let t=qsNullable("#zztestUrl");t&&(t.href=location.href+"&zztest")}static setupLinks(t,e){let r=document.createDocumentFragment(),n=document.createElement("ol");return t.forEach((t=>{let e=document.createElement("a");e.target="linkWin",e.href=t,e.textContent=t;let r=document.createElement("li");r.style.marginTop="1vh",r.appendChild(e),n.appendChild(r)})),r.appendChild(n),e&&qs(e).appendChild(r),r}static setServerDebugInfo(t){this.serverDebugInfo=t+""}static showServerDebugInfo(){let t=O.newDialog(this.serverDebugInfo,"Debug Info","lightblue");t.showModal(),t.dialogElt.style}}G.serverDebugInfo="?";class Q{static remove_zzThings(t){let e=new URL(t),r=e.searchParams,n=new URLSearchParams;r.forEach(((t,e)=>{e.startsWith("zz")||n.set(e,t)}));let i=new URL(e.href);return i.search=n.toString(),i.href}static removeQueryParam(t,e){let r=new URL(t),n=r.searchParams;n.delete(e);let i=new URL(r.href);return i.search=n.toString(),i.href}static setQueryNV(t,e,r){if(!e)throw Error("Invalid arg [name], must not be blank");let n;try{n=new URL(t)}catch(e){throw Error(`[${t} <br>\n`+e)}let i=n.searchParams;e=e.toLowerCase(),i.set(e,r);let s=new URL(n.href);return s.search=i.toString(),s.href}static encodeURIComponentForPath(t){let e=t.split("/");const r=new y;return e.forEach((t=>{r.append(t)})),r.toString()}static toStr(t){"string"==typeof t&&(t=new URL(t));const e=new y;let r="{0} = {1}\n";return e.appendFormat(r,"href",t.href),e.appendFormat(r,"protocol",t.protocol),e.appendFormat(r,"host (authority, includes portNumber)",t.host),e.appendFormat(r,"hostname",t.hostname),e.appendFormat(r,"port",t.port),e.appendFormat(r,"pathname",t.pathname),e.appendFormat(r,"search",t.search),e.toString()}static test1(){new URL("https://developer.mozilla.org/en-US/docs/Web/API/URL/pathname?Q=value&v2=33");let t="https://developer.mozilla.org/en-US/docs/Web/API/URL/pathname?Q=value&v2=33";console.log("url: "+this.toStr(t));let e=Q.setQueryNV(t,"q","v22");console.log("url2: "+this.toStr(e))}}class Z{constructor(){this.lastRequestedUrl="uninit"}dispatch(t,e,r){return console.log("dispatching to url: "+e),this.lastRequestedUrl=e,new Promise(((n,i)=>{(new q).dispatchReturningJSON(t,e,r).then((async t=>{db&&console.log("DataApiResult received from "+e,t);let r=M.assignFrom(t);if(this.resData=r,db&&(console.log("Modified DataApiResult received from "+e,r),console.log("sqlStatements: "+r.sqlStatements)),G.setServerDebugInfo(r.debugInfo),r.exception){if(!r.isPayloadUserError){let t=`not success, exception = <pre> [${r.exception}] \n SQL: ${r.sqlStatements} </pre>`;throw Error(t)}{let t=new T(r.exception);this.errorHandler?await this.errorHandler(t,"DataApiDispatcher.dispatch.catch"):O.showUserError(r.payload,"User Error"),t.handled=!0,i(t)}}else n(r)})).catch((async t=>{let r;if(t instanceof T){if(r=t,r.handled)return}else{let n=`err=${t}`;t instanceof ProgressEvent&&(n+=`, #ProgressEvent, loaded=${t.loaded}, total=${t.total}, lengthComputable:${t.lengthComputable} resource failed to load`),r=new T(n);let i=Q.setQueryNV(p.makeUrlfullyQualified(e),"zzhtml","1");r.htmlMessage=`<br><br>url4html: <a href='${i}' target='_error'> ${i}</a>`}this.errorHandler?await this.errorHandler(r,"DataApiDispatcher.dispatch.catch"):O.showSystemError(r,"DataApiDispatcher.dispatch.catch2"),i(r)}))}))}setErrorHandler(t){this.errorHandler=t}static ErrorToConsoleOnlyHandler(t,e){Z.errCount<3&&console.error(Z.errCount+", ErrorToConsoleOnly: errType="+e+", err=",t),Z.errCount++}}Z.errCount=0;class X{constructor(t){this.fieldDefs=t||[]}addDef(t){return this.fieldDefs.push(t),t}addDate(t,e=!1){return this.addDef({Name:t,Type:Date,Required:e})}addDateTime(t,e=!1){return this.addDef({Name:t,Type:Date,Required:e})}addString(t,e=!1,r=0,n=2e3){return this.addDef({Name:t,Type:String,Required:e,MinLen:r,MaxLen:n})}getField(t,e=!0){let r=this.fieldDefs.find((e=>e.Name===t));if(void 0===r&&e)throw Error("field not found with name: "+t);return r}getFields(...t){return 0===t.length?Array.from(this.fieldDefs):this.fieldDefs.filter((e=>t.some((t=>t===e.Type))))}getDateAndDateTimeFields(){return this.fieldDefs.filter((t=>t.Type===Date||t.Type===E))}getDateFields(){return this.fieldDefs.filter((t=>t.Type===Date))}getDateTimeFields(){return this.fieldDefs.filter((t=>t.Type===E))}static tests(){let t=new X([]);t.addDef({Name:"CreatedOn",Type:String}),t.addDate("CreatedOn"),t.addDate("UpdatedOn");for(let e of t.fieldDefs)e.Type,Date}static parseDatePropertyValues(t,e){let r=Object.getOwnPropertyNames(t);for(let n of r)if("string"==typeof t[n]){let r=e.getField(n,!1);r&&r.Type===Date&&this.parseDateTimeProperty(t,n)}}static parseDateTimeProperty(t,e){let r=t[e];if(void 0===r)throw Error("No property found with name: "+e);if(null===r)return void console.log("val is null");if(""===r)return;if("string"!=typeof r)return;let n=Date.parse(r);if(!isNaN(n)){let t=new Date(n);console.log(t+" parsed date from str: "+r),r=t}t[e]=r}static parsePropertyValues1(t,e){Object.entries(t).forEach((([t,r])=>{let n=e.getField(t,!1);n&&(n.Type,Date)}))}parsePropertyValues(t){this.fieldDefs,this.fieldDefs.forEach((e=>{let r=e.Name,n=t[r];if(void 0===n)console.log(`Not parsed, object does not contain property: ${r}`);else if(null===n)console.log(`Not parsed, value is null for property: ${r}`);else if("string"===e.Type)console.log(`Not parsed, def.Type is string for property: ${r}`);else if("string"!=typeof n)console.log(`Not parsed, typeof property: ${r} is ${typeof n}, not [string]`);else{console.log(`may parse, name: ${r}, val: ${n}, type: ${typeof n} def.type: ${e.Type} `);let i=null;if(e.Type===Date){console.log("def.Type is Date");let t=Date.parse(n);isNaN(t)?console.log("Date.parse return isNaN"):(console.log("Date.parse numeric="+t),i=new Date(t))}null!=i?(console.log(`OK, newParsedVal=${i}`),t[r]=i):console.log("Not parsed")}}))}}class J{static get arrowBackElement(){let t=this.createEl("&#129092;");return t.style.fontWeight="bold",t}static get arrowForwardElement(){let t=this.createEl("&#129094;");return t.style.fontWeight="bold",t}static get busyElement(){let t=this.createEl("&#8635;");return t.className="busyIcon1",t}static get searchElement(){return this.createEl("&#x1F50E;&#xFE0E;")}static createEl(t){let e=document.createElement("span");return e.innerHTML=t,e}static decode(t){let e=document.createElement("textarea");return e.innerHTML=t,e.value}static get checkmarkElement(){let t=this.createEl("&check;");return t.style.fontWeight="bold",t.style.fontSize="30pt",t}static get checkmarkHeavyElement(){let t=this.createEl("&#x2714;");return t.style.fontWeight="bold",t.style.fontSize="30pt",t}static get crossElement(){let t=this.createEl("&cross;");return t.style.fontWeight="bold",t.style.fontSize="30pt",t}static get crossHeavyBallotXElement(){let t=this.createEl("&#x2718;");return t.style.fontWeight="bold",t.style.fontSize="30pt",t}static get infoElement(){let t=this.createEl("&#x1F6C8;");return t.style.fontWeight="bold",t.style.fontSize="30pt",t}static test(){let t=document.createElement("div");t.appendChild(this.arrowForwardElement),t.appendChild(this.arrowBackElement),t.appendChild(this.busyElement),t.appendChild(this.checkmarkElement),t.appendChild(this.checkmarkHeavyElement),t.appendChild(this.crossElement),t.appendChild(this.crossHeavyBallotXElement);let e=this.createEl("&plus; ban: &#x2298; stop: &#x229D; warning: &#x26A0; info: &#x1F6C8;   &quest;  &#x003F;  &#x2753;   ");e.style.fontWeight="bold",e.style.fontSize="30pt",e.style.color="red",t.appendChild(e);let r=document.createElement("span");return r.textContent="asdsdfsdf",r.style.lineHeight="30pt",t.appendChild(r),t}}class Y{constructor(t){this.showStartTime=uninit,t=document.body,this.containerElt=t;const e=function(t,e,r){let n=document.createElement(t);return n.classList.add(e),r.appendChild(n),n};let r=e("div","overlayx",t);{let t=r.style;t.position="fixed",t.top="0",t.left="0",t.width="100%",t.height="100%",t.zIndex=L.getNextZIndex(),t.display="none",this.overlayElt=r}{let t=e("div","overlayx-bg",r).style;t.backgroundColor="lightgoldenrodyellow",t.opacity=".3",t.width="100%",t.height="100%"}let n=e("div","overlayx-content",r);{let t=n.style;t.position="absolute",t.top="30%",t.left="0%",t.width="100%",t.textAlign="center"}{let t=document.createElement("div");n.appendChild(t),t.appendChild(J.busyElement)}{this.mesgElt=e("div","overlayx-text",n);let t=this.mesgElt.style;t.fontSize="1.0em",t.fontWeight="bold",t.backgroundColor="#edd",t.border="red 2px solid",t.maxWidth="500px",t.margin="auto"}{this.progressBarElt=e("div","overlayx-progressBar",n);let t=this.progressBarElt.style;t.fontSize="2.8em",t.fontWeight="bold"}}static showOverlay(t,e){let r=document.body,n=new Y(r);return n.show(t,e),n}show(t,e){if(null===this.overlayElt)throw Error("overlayElt already closed?");this.overlayElt.style.display="unset",this.showStartTime=Date.now(),this.setText(t,e)}setText(t,e){void 0===t&&(t="Loading data"),void 0===e&&(e="Please wait...");let r="";null!=t&&(r=t),null!=e&&(r+="<br>",r+=`<span style='font-size: .9em'>${e}</span>`),this.mesgElt.innerHTML=r}_hideOverlay(){null!==this.overlayElt&&(this.overlayElt.style.display="none",this.overlayElt.remove(),this.overlayElt=null)}hide(){return this.hideWithDelay(Config.MinDataWaitTime)}hidezz(t){return void 0!==t?this.hideWithDelay(t):(this._hideOverlay(),Promise.resolve(0))}hideWithDelay(t){if(null===this.overlayElt)return Promise.resolve(0);let e,r=t-(Date.now()-this.showStartTime);return r>0?e=new Promise(((t,e)=>{console.log("MinDataWaitTime, overlay is being delay for: "+r+" millis");let n=Math.round(r/1e3);setTimeout((()=>{this._hideOverlay(),t(r)}),r),this.progressBarElt.style.color="red",n>0&&(this.progressBarElt.textContent=""+n),n--;let i=0,s=setInterval((()=>{if(i++>500)throw clearInterval(s),Error("setInterval running too many times: "+i);n<0&&(clearInterval(s),console.log("hideWithDelay, interval stopped, counting down LT 0")),n>0&&(this.progressBarElt.textContent=""+n),n--,console.log("counting down: "+n)}),1e3)})):(this._hideOverlay(),e=Promise.resolve(0)),e}static async tests(){let t=new Y(document.body);t.show("111"),t.hideWithDelay(1113e3)}}class tt{constructor(t){this.baseUrl=uninit,this.searchParams=new URLSearchParams,this.baseUrl=t,this.dispatcher=new Z}buildUrl(t,e){if(e===uninit)throw Error("keyID is uninit");let r;e&&(t+="/"+e),r=t?this.baseUrl+t:this.baseUrl;let n=this.searchParams.toString();return n.length>0&&(r+=(r.includes("?")?"&":"?")+n),r}async post(t){let e=this.buildUrl("post");return await this.dispatcher.dispatch("POST",e,t)}async put(t,e){let r=this.buildUrl("put",t);return await this.dispatcher.dispatch("POST",r,e)}async get(t){if(!t)throw Error("KeyID is not available: "+t);let e=this.buildUrl("get",t),r=await this.dispatcher.dispatch("GET",e);if(!r.payload){let n="No record found for keyID: "+t;n+=M.getErrorInfoShort(r),n+=`url: <a href='${e}' target='_error'> ${e}</a>`,console.error(n),console.trace(n);let i=new T(n);throw O.showSystemError(i,"error.get.api"),i}let n=r.payload;if(r.isPayloadUserError){let t=new T("userDataError");throw t.handled=!0,t}return(await this.getDataFieldDefs()).parsePropertyValues(n),n}async getDataFieldDefs(){let t=this.dataFieldDefSet;if(t)console.log("dataFieldDefs fetched: already exist",t);else{let e=this.buildUrl("getDataFieldDefs"),r=await this.dispatcher.dispatch("GET",e);r.payload.forEach((t=>{let e=Object.getOwnPropertyDescriptor(t,"jsReferenceType");if(e){let r=e.value;try{t.Type=Function("return "+r)()}catch(t){console.error("fail to eval jsType: "+r,t)}}})),t=new X(r.payload),console.log("dataFieldDefs fetched: ",t),this.dataFieldDefSet=t}return t}async getNullable(t){return this.get(1)}async delete(t){return await this.call("delete",t)}async deletable(t){return(await this.call("deletable",t)).payload}async call(t,e){let r=this.buildUrl(t,e);return await this.dispatcher.dispatch("GET",r)}async search(t,e,r){void 0===r&&(r=Config.MinDataWaitTime);let n=uninit;t&&(n=Y.showOverlay(t));let i=this.buildUrl("search");try{let t=await this.dispatcher.dispatch("POST",i,e);return n!==uninit&&await n.hideWithDelay(r),t}catch(t){throw n!==uninit&&await n.hideWithDelay(r),t}}async postPayload(t,e){let r=this.buildUrl(t);return(await this.dispatcher.dispatch("POST",r,e)).payload}async postPayloadWithBusyMesg(t,e,r){let n=Y.showOverlay(t);try{return this.postPayload(e,r)}finally{await n.hide()}}async postWithBusyMesg(t,e,r){let n=Y.showOverlay(t);try{let t=this.buildUrl(e),i=await this.dispatcher.dispatch("POST",t,r);return await n.hide(),i}catch(t){throw await n.hide(),t}}async getPayload(t){let e=this.buildUrl(t);return(await this.dispatcher.dispatch("GET",e)).payload}async getPayloadWithBusyMesg(t,e=""){let r=Y.showOverlay(t);try{let t=this.buildUrl(e),n=await this.dispatcher.dispatch("GET",t);return await r.hide(),n.payload}catch(t){throw await r.hide(),t}}getSampleData(){throw Error("To be implemented by sub-class")}getDefaultData(){throw Error("To be implemented by sub-class")}setErrorHandler(t){this.dispatcher.setErrorHandler(t)}}class et{static onwerDoc(t){var e,r;null===(e=t.ownerDocument)||void 0===e||e.documentElement,null===(r=t.ownerDocument)||void 0===r||r.defaultView}createElt_eg_inline(){}createElt_eg1(t,e,r="div"){let n=document.createElement(r);return n.className=t,e.appendChild(n),n}createElt_eg2(t,e,r){let n=document.createElement(t);return n.className=e,r&&r.appendChild(n),n}static toStr(t,e=!1){let r=(new y).toString();return e&&console.log("FormData.toStr",t,r),r}static createChildDivz(t,e=!1){let r=document.createElement("div");return r.id="div"+this.childCreatedCount+++"_"+(new Date).getTime(),r.innerHTML=t,e&&document.body.appendChild(r),r}static setFooterOnBottom(){let t=()=>{let t=window.innerHeight-qs("body>header").clientHeight-qs("body>footer").clientHeight-3;qs("main").style.minHeight=t+"px"};t(),window.addEventListener("resize",(function(e){t()}))}static createSpanElementWithDownAngleIconOnLeft(t){let e=document.createElement("span"),r=document.createElement("i");r.className="fas fa-angle-down",e.appendChild(r);let n=document.createTextNode(" "+t);return e.appendChild(n),e}static createSpanElementWithRightAngleIconOnLeft(t){let e=document.createElement("span"),r=document.createElement("i");r.className="fas fa-angle-right",e.appendChild(r);let n=document.createTextNode(" "+t);return e.appendChild(n),e}static showError(t){let e=this.errorElt;if(!e){e=document.createElement("p");let t=e.style;t.padding="10px",t.position="fixed",t.backgroundColor="lightyellow",t.color="red",t.fontSize="16pt",t.top="5px",t.left="5px",t.zIndex="1123123",document.body.appendChild(e),this.errorElt=e}let r="";r+="<h2> Error: </h3>",r+="Updated: "+(new Date).toLocaleString()+"<hr>",r+=t,e.innerHTML=r}static createDummyDivs(t,e){let r=qs(e),n=document.createElement("section");n.className="dummyDiv",r.appendChild(n);for(let e=0;e<t;e++){let t=document.createElement("div");t.textContent="div "+e,n.appendChild(t)}}}et.parseHTML=function(t){let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,e.body.children},et.childCreatedCount=0;class rt{static test1(){let t,e=t=>t.replace(new RegExp("\\.js\\.js","g"),".js");console.log(t="abcjs.js"," = ",e(t)),console.log(t="abcjs.js.js"," = ",e(t)),new RegExp("zz")}static camelCaseToEnglishTitle_test(){let t=["lowercase","Class","MyClass","HTML","PDFLoader","AString","SimpleXMLParser","GL11Version","99Bottles","May5","BFG9000"];for(let e=0;e<t.length;e++)console.log(t[e]+"= "+this.camelCaseToEnglishTitle(t[e]))}static camelCaseToEnglishTitle(t){return t?(t=t.replace(/([A-Z](?=[A-Z][a-z])|[^A-Z](?=[A-Z])|[a-zA-Z](?=[^a-zA-Z]))/g,"$1 ")).charAt(0).toUpperCase()+t.slice(1):""}static match_tests(){let t="file1.mp3 file2.mp3 file3".match(/(\w+)\.mp3/g);if(t)for(let e=0;e<t.length;e++)t[e]}static exec_tests(){const t="file1.mp3 file2.mp3 file3",e=/(\w+)\.mp3/g;this.toStr(e);let r=e.exec(t);for(;r;){this.RegExpExecArray_toStr(r);const n=r[1];console.log("fn="+n),r=e.exec(t)}}static RegExpExecArray_toStr(t,e=!0){const r=new y;let n="{0}={1}\n";r.appendFormat(n,"input",t.input),n="{0}={1}, ",r.appendFormat(n,"index",t.index),r.appendFormat(n,"length",t.length),r.appendFormat(n,"[0]",t[0]),r.appendFormat(n,"[1]",t[1]),r.appendFormat(n,"groups",t.groups);let i=r.toString();return e&&console.log("RegExpExecArray: "+i),i}static toStr(t,e=!0){const r=new y;let n="{0}={1}\n";r.appendFormat(n,"source",t.source),n="{0}={1}, ",r.appendFormat(n,"flags",t.flags),r.appendFormat(n,"global",t.global),r.appendFormat(n,"ignoreCase",t.ignoreCase),r.appendFormat(n,"multiline",t.multiline),r.appendFormat(n,"lastIndex",t.lastIndex);let i=r.toString();return e&&console.log("RegExp: "+i),i}styleHyphenFormat(t){return t.replace(/[A-Z]/g,(function(t,e,r){return(e>0?"-":"")+t.toLowerCase()}))}}rt.emailRegex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class nt{constructor(t){this.setTemplateLiteral(t)}static test1(){String.raw`Hi\n${5}`;let t=new nt("{ph 2} this is a test, val1={ph1} val2={ph2}"),e="";e=t.evaluateWith({ph1:new Date,ph2:"abc"}),console.log("s="+e),e=t.evaluateWith({ph1:2222,ph2:void 0}),console.log("s="+e),e=t.evaluateWith({}),console.log("s="+e),t.setTemplateLiteral("sdfsadf"),e=t.evaluateWith({ph1:2222,ph2:void 0}),console.log("s="+e),t.setTemplateLiteral("{ph1}"),e=t.evaluateWith({ph1:2222,ph2:void 0}),console.log("s="+e)}hasPlaceHolderExpressions(){return this.placeHolderExpressions.length>0}setTemplateLiteral(t){this.interStrings=[],this.placeHolderExpressions=[];let e=/\{([\w_]{1}[\w_\d: .()'"?+]{0,120})\}/g,r=0,n=0,i=e.exec(t);for(;null!==i;){if(r++>100)throw Error("too many: "+r);rt.RegExpExecArray_toStr(i);const s=i[0],o=i[1],a=i.index;let l=t.substring(n,a);n=a+s.length,console.log("variableName="+o),this.interStrings.push(l),this.placeHolderExpressions.push(o),i=e.exec(t)}let s=t.substring(n);this.interStrings.push(s)}static evaluate(t,e){return new nt(t).evaluateWith(e)}evaluateWith(t){let e=new y;for(let r=0;r<this.placeHolderExpressions.length;r++){e.append(this.interStrings[r]);let n=this.placeHolderExpressions[r],i=this.getValue(t,n);e.append(i)}return e.append(this.interStrings[this.interStrings.length-1]),e.toString()}getValue(t,e){if(e.startsWith("return "))return Function("model",e)(t);let r,n=e,i=null;if(e.includes(":")){let t=e.split(":");n=t[0],i=t[1]}let s=Symbol("not found"),o=class{static tests(){let t,e=this.parseNamesFromPath(t="Master.obj2.key2");console.log("names of path Master.obj2.key2 is",e);let r=this.getValueFromPath("Master.obj2x.key2.z",{Master:{obj2x:{key2:void 0}}},null);console.log("val=",r)}static parseNamesFromPath(t){let e=new RegExp("\\.");return t.split(e)}static getValueFromPath(t,e,r){if("object"!=typeof e)throw Error("Invalid param, obj is not an object: "+e);let n=this.parseNamesFromPath(t),i="",s=e,o=0;for(let e of n){if(console.log(`currPath: ${i}, currObj:`,s),"object"!=typeof s){let t=`KeyNotFound: ${e}, valueAtPath: ${i} isNotAnObject: ${s}`;if(void 0!==r)return console.log(t),r;throw Error(t)}if(null===s){let t=`KeyNotFound: ${e}, valueAtPath: ${i} isNotAnObject: ${s}`;if(void 0!==r)return console.log(t),r;throw Error(t)}if(!Object.prototype.hasOwnProperty.call(s,e)&&!s[e]){let n=`currPath: ${i} doesnotContainKey: ${e}, path=${t}`;if(void 0!==r)return console.log(n),r;throw console.error(n+", currObj=",s),Error(n)}s=s[e],o>0&&(i+="."),i+=e,o++}return s}}.getValueFromPath(n,t,s);if(o===s)r="{"+e+": varPath not found in model}";else if(i){if("YesNo"!==i)throw Error("Invalid string interpolation format: "+i+", from placeHolder: "+e);r=o&&"false"!==o?"Yes":"No"}else r=o instanceof Date?o.toLocaleDateString()+" "+o.toLocaleTimeString():o;return r}}class it{constructor(t){if(this.interpolableElts=[],t){let e=qsMany(".interpolateHTML",0,100,t);e.forEach((t=>{this.addNode(t,!0)})),qsMany(".interpolateDescendantTextNodes, .interpolateText",0,100,t).forEach((t=>{(class{constructor(t){this.containerElt=t}setTextContentFor(t,e){let r=qs(t,this.containerElt);return r.textContent=e,r}static getDescendantNodes(t,e){e=e||[];for(let r=0;r<t.childNodes.length;r++)e.push(t.childNodes[r]),this.getDescendantNodes(t.childNodes[r],e);return e}static getDescendantTextNodes(t,e){e=e||[];for(let r=0;r<t.childNodes.length;r++)t.nodeType===t.TEXT_NODE?e.push(t.childNodes[r]):this.getDescendantTextNodes(t.childNodes[r],e);return e}static traverseTree(t,e){if(!1!==e(t)&&t.hasChildNodes()){let r=t.childNodes;for(let t=0,n=r.length;t<n;++t){let n=r[t];this.traverseTree(n,e)}}}static grep(t,e){let r=[],n=!1;return this.traverseTree(t,(function(t){if(n)return!1;if(t.nodeType!==Node.TEXT_NODE)return!1;let i=t.textContent;return i&&i.length>0&&("string"==typeof e?-1!==i.indexOf(e)&&r.push(t):e.test(i)&&(r.push(t),e.global||(n=!0))),!0})),r}static grep_tests(){setTimeout((()=>{let t=this.grep(document.body,"More");console.log("grepResult",t),t.length>0&&console.log("grepResult0.nodeValue",t[0].nodeValue)}),1e3)}}).traverseTree(t,(t=>{if(e.includes(t))return!1;if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;return e&&e.length>2&&e.indexOf("{")>=0&&this.addNode(t),!1}return!0}))}))}}static interpolateTextContent(t,e){let r=t.textContent+"",n=new nt(r);t.textContent=n.evaluateWith(e)}addNode(t,e=!1){if(this.interpolableElts.some((e=>e.node===t)))return;let r;if(e){if(!(t instanceof HTMLElement))throw Error("elt is not HTML Element");r=t.innerHTML}else r=t.textContent+"";let n=new nt(r);if(n.hasPlaceHolderExpressions()){let r={node:t,interpolator:n,isInterpolatingHTML:e};this.interpolableElts.push(r)}}expandWithDataObject(t){for(const e of this.interpolableElts){let r=e.interpolator.evaluateWith(t);if(e.isInterpolatingHTML){if(!(e.node instanceof HTMLElement))throw"not html elt";e.node.innerHTML=r}else e.node.textContent=r,m.isLocalDebug&&(e.node.textContent=r)}}}class st{static processTags(){m.isMediaScreenMobile,qsMany("[data-mobile-move-content-to]").forEach((t=>{let e=new P(t).get("mobileMoveContentTo"),r=qs(e);r.innerHTML="";let n=t.firstElementChild;if(!n)throw"errr";let i={childEl:n,desktopParent:t,mobileParent:r};this.list.push(i)})),this.processTags2();let t=0;window.addEventListener("resize",(e=>{console.log("resize: "+ ++t),this.processTags2()}))}static processTags2(){let t=m.isMediaScreenMobile;this.list.forEach((e=>{let r=e.childEl,n=e.mobileParent,i=e.desktopParent;t?r.parentElement!==n&&n.appendChild(r):r.parentElement!==i&&i.appendChild(r)}))}}st.list=[];class ot{static hiliteText(t,e={}){var r,n,i;let s=null!==(r=e.newText)&&void 0!==r?r:t,o=null!==(n=e.bgColor)&&void 0!==n?n:this.defaultHiliteBgColor,a=0,l=document.createTreeWalker(null!==(i=e.rootNode)&&void 0!==i?i:document.body,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_DOCUMENT_FRAGMENT,{acceptNode:t=>t instanceof HTMLSpanElement&&t.classList.contains(this.hilitedClassName)||t instanceof HTMLOptionElement||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?NodeFilter.FILTER_REJECT:t.nodeType!==t.TEXT_NODE?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}),c=[];{let t=l.currentNode;for(;null!==t;)t=l.nextNode(),t&&c.push(t)}return c.forEach((r=>{var n;if(r.nodeType===r.TEXT_NODE){let i=r.textContent;if(i&&i.includes(t)){console.log("found Text: "+i);let l=i.split(t),c=l.length,d=document.createDocumentFragment();for(let r=0;r<c;r++){const n=l[r];if(n.length>0&&d.appendChild(document.createTextNode(n)),r<c-1){a++;let r=f.span_c(this.hilitedClassName,s);r.style.backgroundColor=o,e.color&&(r.style.color=e.color);let n=`Ocurrence #${a}`;t!==s&&(n+=", was: "+t),d.appendChild(r)}}null===(n=r.parentElement)||void 0===n||n.replaceChild(d,r)}}})),a}}ot.hilitedClassName="dom-hilited",ot.defaultHiliteBgColor="yellow";class at{constructor(t){this.elt=t,this._classList=this.elt.classList,this.origClassListValue=this.elt.classList.value}get classList(){return this._classList}appendToToken(t,e){if(!this._classList.contains(t))throw Error("no token found: "+t+", validTokens are: "+this._classList.value);this._classList.replace(t,t+e)}reset(){this._classList.value=this.origClassListValue}}class lt{constructor(t){this.elt=t,this.origAttrCol={}}switchAttr(t,e){console.log(`settingNewAttr ${t}=${e}`),Object.keys(this.origAttrCol).find((e=>e===t))||(console.log("not yet existed"),this.elt.hasAttribute(t),this.origAttrCol[t]=this.elt.getAttribute(t)),this.elt.setAttribute(t,e)}switchAttrs(t){let e=Object.keys(t),r=1;for(let n of e){let e=t[n];this.switchAttr(n,e),console.log(r),r++}}reset(){let t=1;for(let e in this.origAttrCol){if(!this.origAttrCol.hasOwnProperty(e))continue;let r=this.origAttrCol[e];console.log(`${t} settingBackAttr ${e}=${r}`),null==r?(console.log(`removeAttr ${e}=${r}`),this.elt.removeAttribute(e)):(console.log(`setAttr ${e}=${r}`),this.elt.setAttribute(e,r)),t++}}}class ct{static get isChromeBrowser(){return(navigator.vendor+"").includes("Google")}static get isFirefoxBrowser(){return navigator.userAgent.includes(" Firefox/")}static get isEdgeBrowser(){return navigator.userAgent.includes(" Edge/")}static get isIEBrowser(){navigator.userAgent;let t=window.navigator.userAgent;return/MSIE|Trident/.test(t)}static get isAntiquatedBrowser(){return this.isIEBrowser}}class dt{static HandleErrorFromMain(t){console.trace(t);let e=(t.mesg||t)+"";t.handled||e.toLocaleLowerCase().includes("#handled")?console.warn("Globally catched error already handled: ",t):(console.error("Globally catched error not handled: ",t),O.showSystemError(t,"global.catch"))}static init(){window.addEventListener("error",(t=>{let e=t.error;if(e)if(e.message){console.warn("globally err.stack",e.stack);let t=`<h2>.GlobalError catched: </h2>mesg: ${e.message}, <br>stack:<pre>${e.stack} </pre>`;e.message.indexOf("SecurityError")>=0&&ct.isAntiquatedBrowser?console.log("isAntiquatedBrowser, SecurityError on IE"):windowExtBag.showAlert(t)}else console.log("ErrorEvent, message property not found",t);else console.warn("globe ball er ror catched",t)})),window.addEventListener("unhandledrejection",(function(t){if(console.warn("unhandledrejection, PromiseRejectionEvent=",t),t.reason.handled);else{let e="unhandledrejection: "+t.reason;windowExtBag.showAlert(e)}})),windowExtBag.showAlert=function(t){if("function"==typeof windowBag.ModalBox_showAlert)windowBag.ModalBox_showAlert(t);else{let e=document.createElement("p");e.textContent=t,document.body.insertBefore(e,document.body.firstChild),console.log("error elt added",e)}}}}class ut{constructor(t){this.colHeaderRowElt=t,this.sortCols=[]}toggleSortDirection(t,e){let r;if(this.sortCols.forEach((n=>{n.parentContainerElt===t?(e?n.show(e):n.toggleSortDirection(),r=n):n.hide()})),!r)throw Error("nto found elmg for coL: "+getTagNameIDClass(t));return r}hideAll(){this.sortCols.forEach((t=>{t.hide()}))}createColumnSortElt(t,e){let r=new ht(t,e);return this.sortCols.push(r),r}}class ht{constructor(t,e){this.parentContainerElt=t,this.iconContainer=document.createElement("span"),this.iconContainer.className=ht.sortIconContainerClassName,this.iconContainer.dataset.fieldName=e,t.appendChild(this.iconContainer)}static find(t){let e=qs(t),r=qs("."+this.sortIconContainerClassName,e);return new ht(e,r.dataset.fieldName+"")}get sortedDir(){return this.iconContainer.dataset.sortedDir+""}set sortedDir(t){if("ASC"!==t&&"DESC"!==t)throw Error("invalid sortDir: "+t);this.iconContainer.dataset.sortedDir=t}getSortReversedDir(){let t;return t="ASC"===this.iconContainer.dataset.sortedDir?"DESC":"ASC",t}get fieldName(){return this.iconContainer.dataset.fieldName+""}toggleSortDirection(){let t=this.getSortReversedDir();this.show(t)}show(t){let e,r=this.iconContainer;if(t){if("ASC"!==(t=t.toUpperCase())&&"DESC"!==t)throw Error("invalid sortDir: "+t);e=t}else e=r.dataset.sortedDir?r.dataset.sortedDir:"ASC";let n=document.createElement("i"),i=n.style;i.color="black",i.fontSize="0.8em",i.fontWeight="normal",i.marginLeft="1px",n.className="ASC"===e?"fas fa-arrow-up":"fas fa-arrow-down",this.sortedDir=e,r.dataset.sortedTime=Date.now()+"",console.log("iconContainer sorted",r),r.innerHTML="",r.appendChild(n)}hide(){this.iconContainer.innerHTML=""}}ht.sortIconContainerClassName="sortedIconContainer";class pt{constructor(){this.isBusy=!1}static toStr(t,e=!1){let r=(new y).toString();return e&&console.log("FormData.toStr",t,r),r}static makeContentAhrefOrShowErr(t,e){let r=document.createElement("a");r.href="javascript:void(0);";let n=t.textContent;if(null===n){let t="textContent is null, "+e;throw console.trace(t),O.showSystemError(t,"makeContentAHref"),Error(t)}return n=n.trim(),0===n.length&&(n="LinkLabel123"),r.textContent=n,t.innerHTML="",t.appendChild(r),r}static setContentAhref(t,e,r="javascript:void(0);"){let n=document.createElement("a");return n.href=""+r,n.innerHTML=e,t.innerHTML="",t.appendChild(n),n}static disableTemporarily(t,e){t.setAttribute("disabled","disabled"),setTimeout((()=>{t.removeAttribute("disabled")}),2e3)}removeBusy(){throw ReferenceError("setBusy method must implement this method")}setBusy(t){console.log("set Busy...................................."),this.isBusy=!0,t.style;let e=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin"></i> '+t.textContent;let r=new S(t),n=new at(t),i=new lt(t);i.switchAttrs({disabled:"disabled"}),r.switchStyles({"zfont-size":"smaller",color:"#bbb",padding:"5px"}),n.appendToToken("dialogx-button","-disabled");let s="busyDuration-MDB"+ ++pt.timerID+"Timer";console.time(s),this.removeBusy=()=>{this.isBusy&&(t.innerHTML=e,r.reset(),n.reset(),i.reset(),console.log("Busy removed......................................."),console.timeEnd(s),this.isBusy=!1)}}static getOuterWidth(t){let e=t.offsetWidth,r=getComputedStyle(t);return e+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),e}static getOuterHeight(t){let e=t.offsetHeight,r=getComputedStyle(t);return e+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),e}}pt.timerID=0;class mt{constructor(t){if(!(t instanceof HTMLInputElement))throw Error("x");this.elt=t,this.elt.form}static queryElementByName(t,e){let r=t.querySelector(`[name=${e}]`);if(null==r)throw gt.getFieldsShortInfo(t),Error("No input field found for name: "+e);if(!(r instanceof HTMLInputElement))throw Error("Not instanceof HTMLInputElement for name: "+e);return r}static filloutValue(t,e){if(!(t instanceof HTMLInputElement))throw Error("Not instanceof HTMLInputElement for name: "+name);return t.value=e,t}set setElement(t){this.elt=t}get element(){return this.elt}set setValue(t){this.elt.value=t}get value(){return this.elt.value}toString(){return mt.stringify(this.elt)}static stringify(t){let e={};e.nodeName=t.nodeName,e.type=t.type,t.name&&(e.name=t.name),t.value&&(e.value=t.value),t.id&&(e.id=t.id),-1!==t.maxLength&&(e.maxlength=t.maxLength),e.class=t.classList,e.instanceof="HTMLInputElement";let r=JSON.stringify(e);return console.log(r),r}}class gt{static genNextID(){return"formx"+ ++this.currentID}static setupID(t){if(t.id)throw Error("form already has ID set: "+t.id);t.id=this.genNextID()}reset(){}static setFields_ID_and_LabelFor_fromName(t){let e=t.elements,r=t.id;if(!r){let e="";throw console.log(e="formID not found",t),Error(e)}for(let t=0;t<e.length;t++){let n=e.item(t),i=n.name;if(i&&n.parentElement){let t=n.parentElement.querySelector("label");t&&t.parentElement===n.parentElement&&(n.id?console.log("labelFor: "+n.id):(n.id=r+"_"+i,console.log("labelFor, id autoset: "+n.id)),t.htmlFor=n.id)}}}static changeDateInputsToUseJQuery(t){Config.isUsingJQueryDialog&&class{static changeDateInputsToUseJQuery(t){Array.prototype.slice.call(t.elements).forEach((t=>{t instanceof HTMLInputElement&&("date"===t.type||"date"===t.getAttribute("type"))&&(t.type="text",t.setAttribute("type","text"),t.classList.add("jquery-datepicker-processed"),jQuery(t).datepicker({changeMonth:!0,changeYear:!0}))}))}}.changeDateInputsToUseJQuery(t)}static disableForm(t){console.log("disabling form",t),qs("#formFieldset",t.formElt).disabled=!0,Array.prototype.slice.call(t.elements).forEach((t=>{HTMLInputElement,"FIELDSET"!==t.nodeName&&t.hasAttribute("disabled")&&(console.log("disabling elt: ",t,t.nodeName),t.setAttribute("disabled","disabled"),t.style.backgroundColor="#eee")}))}static stringify(t){if(document.querySelector("#form1"),document.forms[0],!t)throw Error("Invalid Argument f: "+t);let e=Array.prototype.slice.call(t.elements),r=new Array,n=new y;return e.forEach((t=>{let e=!1,n={};n.nodeName=t.nodeName,e=!0,t instanceof HTMLInputElement?(mt.stringify(t),e=!0):t instanceof HTMLSelectElement||t instanceof HTMLElement&&(n.isHTMLElement=!0),e&&r.push(n)})),r.forEach((t=>{n.appendLine(JSON.stringify(t)),n.appendLine()})),console.log(n.toString()),n.toString()}static getFieldsShortInfo(t){let e=Array.prototype.slice.call(t.elements),r=new y;return r.appendLine("Fields for form: "+t.id),e.forEach((t=>{t instanceof HTMLInputElement?(mt.stringify(t),r.append(`name: ${t.name}`)):t instanceof HTMLElement&&r.append(`tagName: ${t.tagName} `),r.append(`nodeName: ${t.nodeName} `),r.appendLine()})),console.log(r.toString()),console.log(t),r.toString()}static getKeyIDFromFormElement(t){let e=qsClosest("form",t).dataset.keyId;if(!e)throw Error("keyId not found in parent FormElement dataset");return parseInt(e,10)}static setupChangeInputEvents(t,e){let r,n=Array.prototype.slice.call(t.elements);for(r of n){let t=r.getAttribute("name");if(null==t)continue;let n="?",i="";if(r instanceof HTMLTextAreaElement)i+="textArea.value",n="input";else if(r instanceof HTMLSelectElement)i+="select.value",n="change";else{if(!(r instanceof HTMLInputElement))throw Error("unknown elt: "+r.nodeName);"date"===r.type?(i+="input.date",n="input"):"radio"===r.type?(i+="radio, presetVal="+r.value,n="change"):"file"===r.type?(i+="file.",n="change"):(i+="input.else",n="input")}console.log(`formElt: name: ${t}, eventType: ${n}, info: ${i}`),"change"!==n&&r.addEventListener(n,e)}t.addEventListener("change",e)}}gt.currentID=0;class ft extends class extends class extends class{constructor(t){this.el=t,this.st=t.style}innerHTML(t){return this.el.innerHTML=t,this}innerText(t){return this.el.innerText=t,this}fixColor(t){return t}fixVal(t){return t}css(t,e){return this.st.setProperty(t,e),this}color(t){return this.st.color=this.fixColor(t),this}backgoundColor(t){return this.st.backgroundColor=this.fixColor(t),this}display(t){return this.st.display=this.fixVal(t),this}fontSize(t){return this.st.fontSize=this.fixVal(t),this}width(t){return this.st.width=this.fixVal(t),this}zIndex(t){return this.st.zIndex=this.fixVal(t),this}}{attr(t,e){return"number"==typeof e?this.el.setAttribute(t,e.toString()):e&&this.el.setAttribute(t,e),this}cols(t){return this.attr("cols",t)}readonly(t){return this.el.toggleAttribute("readonly",null==t||t),this}required(t){return this.el.toggleAttribute("required",null==t||t),this}rows(t){return this.attr("rows",t)}src(t){return this.attr("src",t)}style(t){return this.attr("style",t)}target(t){return this.attr("target",t)}x(t){return this.attr("",t)}}{createChild(t,e){let r=document.createElement(t);return e&&(e.includes(":")?r.setAttribute("style",e):r.className=e),null!=this.el&&this.el.appendChild(r),new ft(r)}createChildRepeat(t,e=1,r){let n;for(let i=0;i<e;i++)n=this.createChild(t,r);return n}appendChild(t){this.el.appendChild(t.el)}prependChild(t){this.el.prepend(t.el)}createArticle(t){return this.createChild("article",t)}createBr(t=1,e){return this.createChildRepeat("br",t,e)}createButton(t,e="method",r,n="btnx btnx-primary"){return this.createChild("button",n).attr("type","submit").attr("name",e).attr("value",null!=r?r:t).innerHTML(t)}createDiv(t){return this.createChild("div",t)}createForm(t="post",e="application/x-www-form-urlencoded",r="formx"){return this.createChild("form",r).attr("method",t).attr("enctype",e)}createH1(t){return this.createChild("h1",t)}createH2(t){return this.createChild("h2",t)}createH3(t){return this.createChild("h3",t)}createH4(t){return this.createChild("h4",t)}createH5(t){return this.createChild("h5",t)}createH6(t){return this.createChild("h6",t)}createInput(t,e,r="ff-control"){return this.createChild("input",r).attr("name",t).attr("value",e)}createInputFieldCell(t,e,r,n="ff-control"){let i=this.createRowCell();return i.createLabel(e),i.createChild("input",n).attr("name",t).attr("value",r)}createCheckboxFieldCell(t,e,r,n="zff-control"){let i=this.createRowCell().createLabel(e,"cb-label").createChild("input",n).attr("name",t).attr("value",r);return i.el.type="checkbox",i}createLabel(t,e="ff-label"){return this.createChild("label",e).innerHTML(t)}createRow(t="d-2"){return this.createChild("section",t)}createRowCell(t=""){return this.createChild("div",t)}createSection(t){return this.createChild("section",t)}createSpan(t,e){return this.createChild("span",e).innerHTML(t)}create(t){return this.createChild("",t)}}{constructor(t){super(t)}static qs(t){return t instanceof ft?t:new ft(qs(t))}static qsNullable(t){if(t instanceof ft)return t;{let e=qsNullable(t);return null===e?null:new ft(e)}}static qsElement(t){let e;return t instanceof ft?(e=t.el,e):qs(t)}surroundsWith(t){let e=ft.qsElement(t),r=this.el.parentElement;return r&&r.insertBefore(e,this.el),e.appendChild(this.el),this}static createRoot(t,e){let r=document.createElement(t);return e&&(e.includes(":")?r.setAttribute("style",e):r.className=e),new ft(r)}createDetailsSummary(t,e){let r=this.createChild("details",e);return r.createChild("summarry").el.innerHTML=t,r}}ft.body=new ft(document.body);class wt{static observeSelector(t){const e=qs(t);console.log("observing node: ",e),new MutationObserver(((t,e)=>{for(const e of t)if("childList"===e.type){let t=e.addedNodes,r=e.removedNodes,n=document.querySelectorAll("*").length;console.log(`=========== observed, added/removed=${t.length}/${r.length} total nodes count: ${n}`)}else if("attributes"===e.type);else if("characterData"!==e.type)throw Error("unknown mutation.type: "+e.type)})).observe(e,{attributes:!0,childList:!0,subtree:!0})}static showTotalNodes(){console.log("=========== observed, total nodes count: ",document.querySelectorAll("*").length)}}wt.debug=!1,windowExtBag.MutationObserverX=wt;class yt{static getInfo(){let t="currentRoute: "+yt.currentRoute;return t+=",\n",t+=" segments= ["+this.routeSegments.join(", ")+"]",t}static getRoutSegmentsStr(){return"["+this.routeSegments.join(", ")+"]"}static equals(t){return this.currentRouteLower===t.toLowerCase()}static containsSegmentAt(t,e){let r=this.routeSegments[e];return l.ciEquals(r,t)}static containsSegment(t){return t=t.toLowerCase(),this.routeSegments.some((e=>l.ciEquals(e,t)))}static startsWith(t){return t=t.toLowerCase(),this.currentRouteLower.startsWith(t)}static endsWith(t){return t=t.toLowerCase(),this.currentRouteLower.endsWith(t)}}i=yt,yt.currentRoute=uninitString,yt.currentRouteLower=uninitString,yt.routeSegments=uninit,(()=>{if(i.currentRoute===uninitString){let t=p.searchParams.getNullable("page");null===t&&(t=p.searchParams.getOrDefault("route","")),i.currentRoute=t,i.currentRouteLower=t.toLowerCase(),i.routeSegments=i.currentRoute.split("-"),console.log("currentRoute="+t),console.log("routeFragments=",i.routeSegments.join(", "))}})();class Et{static getHeight_eg1(t){let e=t.cloneNode(!0);e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e);let r=e.offsetHeight+0;return document.body.removeChild(e),e.style.visibility="visible",r}static getOuterWidth(t){let e=t.offsetWidth;const r=getComputedStyle(t);return e+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),e}static getOuterHeight_px(t){return this.getOuterHeight(t)+"px"}static getOuterHeight(t){let e=t.offsetHeight;const r=getComputedStyle(t);return e+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),e}}class bt{static disable(){this.isEnabled=!1}static init(t){if(null===t&&(t=qs("body>header")),!this.isEnabled)return void console.log("not useStatusBar, not init");let e=(t,e,r="div")=>{let n=document.createElement(r);return t&&(n.className=t),e.appendChild(n),n},r=document.createElement("section");r.className="statusBar",this.statusBarElt=r;let n=e("statusBarButtonWrapper",r);{let t=e("",n,"button");t.title="Toggle info message",t.innerHTML="&#8560;";let r=t.style;r.fontWeight="bold",r.fontSize="20pt",t.addEventListener("click",(()=>{this.toggleMessageElt()}))}let i=this.statusBarElt.style;i.visibility="visible";let s=t.getBoundingClientRect().bottom;s<t.getBoundingClientRect().height&&(s=Et.getOuterHeight(t)),i.top=s+"px",console.log("statusBar top set to: "+s),this.statusBarMesgWrapperElt=e("statusBarMesgWrapper",r),document.body.appendChild(r)}static ensureInit(){if(!this.statusBarElt){let t="statusBar hasn not been init";throw console.error(t),Error(t)}}static setTop(t){this.statusBarElt.style.top=t+"px"}static async setText(t,e=!1){if(!this.isEnabled)return void console.log("not useStatusBar, mesg="+t);this.ensureInit(),this.hideMessageElt(),await class{static sleep(t){return new Promise((e=>setTimeout(e,t)))}static Sleep(t){return new Promise((e=>setTimeout(e,t)))}static delay(t,e){return new Promise((r=>{setTimeout((()=>{r(e)}),t)}))}}.sleep(300),this.currentTextMesg=t,this.timeoutHandle&&clearTimeout(this.timeoutHandle);let r=document.createElement("div");this.statusBarTextElt=r,r.className="statusBarMesg",r.textContent=t,console.log("Setting status bar mesg to: "+t),this.statusBarMesgWrapperElt.style.display="",location.href.includes("zzstay")&&(e=!0),e||setTimeout((()=>{r.style.opacity="0.5",this.timeoutHandle=setTimeout((()=>{this.hideMessageElt()}),4e3)}),3e3),class{createElt_eg2(t,e,r="div"){let n=document.createElement(r);return n.className=t,e.appendChild(n),n}createElt_eg(t,e,r){let n=document.createElement(t);return n.className=e,r.appendChild(n),n}static insertBefore(t,e){let r=qs(e),n=r.parentElement;if(!n)throw"parent Element is null for: "+getTagNameIDClass(r);n.insertBefore(t,r)}static insertAfter(t,e){let r=qs(e),n=r.parentElement;if(!n)throw"parent Element is null for: "+getTagNameIDClass(r);n.insertBefore(t,r.nextSibling)}static replaceChild(t,e){let r=qs(e),n=r.parentElement;if(!n)throw"parent Element is null for: "+getTagNameIDClass(r);n.replaceChild(t,r)}static replaceInnerHTML(t,e){let r=qs(t);if(!(r instanceof Element))throw Error(`${t} is not an Html Element`);if(r.innerHTML="",!(e instanceof Node))throw Error(`${e} is not a type of  Node`);r.appendChild(e)}static toStr(t,e=!1){let r=(new y).toString();return e&&console.log("FormData.toStr",t,r),r}static gotoBottom(t){let e=qs(t);e.scrollTop=e.scrollHeight-e.clientHeight}static isTheEndOfItsScroll(t){return t.scrollHeight-t.clientHeight===t.scrollTop}static getSiblings(t,e){let r=[];if(null!==t.parentNode){t=t.parentNode.firstChild;do{e&&!e(t)||r.push(t),t=t.nextSibling}while(t)}return r}static selectElementContents(t){let e=document.createRange();e.selectNodeContents(t);let r=window.getSelection();null!==r&&(r.removeAllRanges(),r.addRange(e))}static selectElementPart(t){let e=t.firstChild,r=t.lastChild,n=document.createRange();if(t.focus(),null===e)throw"fc";if(null===r)throw"lc";n.setStart(e,1),n.setEnd(r,3);let i=window.getSelection();null!==i&&(i.removeAllRanges(),i.addRange(n))}static createHotspot(t,e,r="100%",n="40px"){let i=document.createElement("div");i.className="hotspot";let s=i.style;return s.position="absolute",s.top="0px",s.left="0px",s.width="40px",s.height="200px",t.appendChild(i),i.addEventListener("click",(async t=>{e()})),i}}.replaceInnerHTML(this.statusBarMesgWrapperElt,r)}static toggleMessageElt(){"none"===this.statusBarMesgWrapperElt.style.display?this.showMessageElt():this.hideMessageElt()}static showMessageElt(){clearTimeout(this.timeoutHandle),this.statusBarMesgWrapperElt.style.display="",this.statusBarTextElt.style.opacity="1"}static hideMessageElt(){this.statusBarMesgWrapperElt.style.display="none"}static async test1(){bt.setText("This is a test mesg to see it it works well!"),document.addEventListener("click",(()=>{}))}}bt.isEnabled=!0,bt.currentTextMesg="uninit";class vt{static pre(t){return this.el("pre",t)}static el(t,e){let r;r=e instanceof HTMLElement?e.outerHTML:e;let n=document.createElement(t);return n.innerText=r,this.mainEl.appendChild(n),n}static ahref(t,e){e||(e=t);let r=this.html("a",e);return r.setAttribute("href",t),this.html("br"),this.html("br"),r}static div(t){return this.html("div",t)}static html(t,e){let r="";e instanceof HTMLElement?r=e.outerHTML:e&&(r=e);let n=document.createElement(t);return r&&(n.innerHTML=r),this.mainEl.appendChild(n),n}static appendChild(t){this.mainEl.appendChild(t)}static tests(){this.pre("a string");let t=document.createElement("div");this.pre(t)}}vt.mainEl=qs("main");class Dt{constructor(t){this.tab=t}static readData(t){var e;let r=null===(e=t.tHead)||void 0===e?void 0:e.rows.item(1),n=t.tBodies[0],i=(n.rows.length,r.cells.length,[]);if(r){let t=[];for(let e of r.cells)t.push(e.textContent+"");i.push(t)}if(n)for(let t of n.rows){let e=[];for(let r of t.cells)e.push(r.textContent+"");i.push(e)}return i}static toHtml(t){let e=ft.createRoot("table");e.attr("border","1");for(let r of t){let t=e.createChild("tr");if(r)for(let e of r)t.createChild("td").el.innerText=e+"";else t.createChild("td").innerText("row is empy")}return e.el}static tests(){vt.div(this.toHtml([[1,"a"],["bb",22]]))}}class Ct{}Ct.UPPERCASE_A=65,Ct.LOWERCASE_A=97,Ct.UPPERCASE_Z=90,Ct.LOWERCASE_Z=122,Ct.DOT=46,Ct.FORWARD_SLASH=47,Ct.BACKWARD_SLASH=92,Ct.VERTICAL_LINE=124,Ct.COLON=58,Ct.QUESTION_MARK=63,Ct.UNDERSCORE=95,Ct.LINE_FEED=10,Ct.CARRIAGE_RETURN=13,Ct.TAB=9,Ct.FORM_FEED=12,Ct.EXCLAMATION_MARK=33,Ct.HASH=35,Ct.SPACE=32,Ct.NO_BREAK_SPACE=160,Ct.ZERO_WIDTH_NOBREAK_SPACE=65279,Ct.LEFT_SQUARE_BRACKET=91,Ct.RIGHT_SQUARE_BRACKET=93,Ct.LEFT_ANGLE_BRACKET=60,Ct.RIGHT_ANGLE_BRACKET=62,Ct.LEFT_CURLY_BRACKET=123,Ct.RIGHT_CURLY_BRACKET=125,Ct.HYPHEN_MINUS=45,Ct.PLUS=43,Ct.DOUBLE_QUOTE=34,Ct.SINGLE_QUOTE=39,Ct.PERCENT=37,Ct.SEMICOLON=59,Ct.CIRCUMFLEX_ACCENT=94,Ct.GRAVE_ACCENT=96,Ct.AT=64,Ct.AMPERSAND=38,Ct.EQUAL=61,Ct[0]=48,Ct[9]=57,Ct[3]="dd",null===(s=globalThis.Deno)||void 0===s||s.noColor,new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");class St{}St.Reset="[0m",St.Bright="[1m",St.Dim="[2m",St.Underscore="[4m",St.Blink="[5m",St.Reverse="[7m",St.Hidden="[8m",St.FgBlack="[30m",St.FgRed="[31m",St.FgGreen="[32m",St.FgYellow="[33m",St.FgBlue="[34m",St.FgMagenta="[35m",St.FgCyan="[36m",St.FgWhite="[37m",St.BgBlack="[40m",St.BgRed="[41m",St.BgGreen="[42m",St.BgYellow="[43m",St.BgBlue="[44m",St.BgMagenta="[45m",St.BgCyan="[46m",St.BgWhite="[47m";class Tt{}class xt{egs(){let t=Object();Object.entries(t).forEach((([t,e])=>{}));for(const[e,r]of Object.entries(t));}static fromEntries(t){let e=-1,r=null==t?0:t.length,n={};for(;++e<r;){let r=t[e];n[r[0]]=r[1]}return n}static isNullOrUndefined(t){return null==t}classOf(t){return Object.prototype.toString.call(t)}typeOf(t){return Object.prototype.toString.call(t).replace(/^\[object (.+)\]$/,"$1")}static getType(t){if(null==t)return typeof t;if(this.isNullOrUndefined(t.constructor))throw Error("constructoR not defined");let e=String(t.constructor).match(/function\s+(\w+)/);return e?e&&e.length>0?e[1]:"undefined":typeof t}test1(){let t=Object.create({},{getFoo:{value:function(){return this.foo}}});t.foo=1,console.log(Object.keys(t))}static showOwnProperties(t,e){if(null==t)return void console.log("obj is null");let r=Object.getOwnPropertyNames(t),n=new y;for(let e of r){let r=t[e],i=this.getType(r);n.appendLine(`${e}: ${i} = ${r}`),t.hasOwnProperty(e)}e+=", ownProperties: ",console.log(e,t)}static deleteAllProperties(t){for(let e in t)t.hasOwnProperty(e)&&delete t[e];console.log("props deleted",t)}static deleteAllProperties_tests(){let t={a:1,bb:"two"};console.log("o1",t),xt.deleteAllProperties(t),console.log("o1",t)}static getNonEmptyProperties(t){let e={};for(let r in t){if(!t.hasOwnProperty(r))continue;let n=t[r];"function"!=typeof n&&n&&(e[r]=n)}return console.log("new obj",t),e}static async TestsAsync(){}static isEmpty(t){if("string"==typeof t||""===t)return!1;if("number"==typeof t||0===t)return!1;if("boolean"==typeof t)return!1;for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}static getValue(t,e,r){if("object"!=typeof t)throw Error("Invalid param, obj is not an object: "+t);if(Object.prototype.hasOwnProperty.call(t,e))return t[e];{let n=`key [${e}] not found in obj`;if(console.warn(n,t),void 0!==r)return r;throw Error(n)}}static cloneShallow(t){let e=Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t));return e=Object.assign({},t),e=Object.assign({},t,{},{}),Object.values(e),e}static cloneDeep(t){let e=JSON.stringify(t);return JSON.parse(e)}static completeAssign(t,...e){return e.forEach((e=>{let r=Object.keys(e).reduce(((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t)),{});Object.getOwnPropertySymbols(e).forEach((t=>{let n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n)throw"?";n.enumerable&&(r[t]=n)})),Object.defineProperties(t,r)})),t}static deepFreeze(t){let e=Object.getOwnPropertyNames(t);for(let r of e){let e=t[r];t[r]=e&&"object"==typeof e?this.deepFreeze(e):e}return Object.freeze(t)}static freeze(t){return Object.freeze(t)}testFreeze(){Object.freeze({x:1,y:2})}strictAssignv(t,...e){return Object.assign(t,...e)}static toStr(t){return this.asString(t)}static asString(t){return"string"==typeof t?t:null==t||"number"==typeof t||"boolean"==typeof t||"bigint"==typeof t||"symbol"==typeof t?String(t):"object"==typeof t?JSON.stringify(t):"undefined"}}class Lt{static refreshBrowserOnServerRequest(t){let e=t.dispatcher.resData;if(!e)throw Error("resData null");m.apiVersion===uninitString?(m.apiVersion=e.apiVersion,console.log("first time, does nothing, now apiVersion: "+m.apiVersion)):m.apiVersion!==e.apiVersion?(location.reload(),console.log("***Refreshing browser b/c change apiVersion: "+m.apiVersion)):Config.isLocalDebug&&console.log("Not Refreshing browser b/c not change")}static fixHyperLinks(t){void 0===t&&(t="body>header");let e=qs(t);qsAll("a",e).forEach((t=>{let e=t;e.dataset.href&&(e.href=e.dataset.href.replace("{apiRootUrl}",m.DataApiUrlRoot))}))}static setupUnimplemented_onClicked(){Config.isDebug||qsAll(".unimplemented").forEach((t=>{t.addEventListener("click",(t=>(O.showInfo("This feature is currently unvailable, please check back later."),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),!1)))}))}static setPageContent(t){let e=qs(".contentDiv");e.innerHTML="",t instanceof Node?e.appendChild(t):e.innerHTML=t+""}static setupIframeToggleButton(t){let e=document.createElement("a");e.textContent="Top";let r=document.createElement("span");r.className="topParentLink",r.appendChild(e),m.isWindowBeingIframed?(console.log("already being iframed"),e.href=location.href,e.textContent="Stand Alone",e.title="Open this iframe in top window",e.addEventListener("click",(t=>{top.location.href=location.href,t.preventDefault()})),document.body.appendChild(r)):(t+=location.search,e.href=t,e.textContent="Iframe in",e.title="iframe this in parent page",document.body.appendChild(r))}static setPageFooterOnBottom(){let t=()=>{let t=window.innerHeight-qs("body>header").clientHeight-qs("body>footer").clientHeight,e=qsNullable("main");null===e&&(e=qs("#main")),e.style.minHeight=t+"px"};window.addEventListener("resize",(function(e){t()})),window.addEventListener("load",(function(e){t()})),t(),setTimeout((()=>{t()}),1),setTimeout((()=>{t()}),1e3)}static populateBasicInfo(){qs("#lbBottomMiddle").innerHTML="&copy;"+(new Date).getFullYear()+" CCDOA",m.isAdminApp&&(qs("#lbBottomLeft").textContent=`${V.username} (${V.userRoles})`),qs("#appEnv").textContent=`(${V.dbEnv})`}static SetDocumentTitle(t){let e;e=m.isDbDev?"Dev-":m.isDbQA?"QA-":"",m.isLocalhost&&(e="Local "+e),t=`${e}${t}`,document.title=t}}class It{static async init(t){m.init(t),alreadyExecuted("AppInit.init")||(m.isLocalDebug&&await G.RunDevTasks(),G.processEnvTags(),Lt.setupUnimplemented_onClicked())}static async postInit(){alreadyExecuted("AppInit.postInit")||(await class{static async handle_zzStuff(){if(alreadyExecuted("DxLib.handle_zzStuff"))return;if(!location.href.toLowerCase().includes("zz"))return;let t=new URLSearchParams(location.search.toLowerCase()).get("zzuname");t&&t.length>0&&(j.setValue("zzuname",t,1/0,"/"),await O.showInfo("username set in cookie to: "+t),location.href=location.href.replace("zzuname","zzunamx"))}}.handle_zzStuff(),m.isLocalhost&&location.href.includes("zz-libtest")&&await class{static async runTests(){let t=location.href.toLowerCase();this.handleDialogTests(),t.includes("zz-icon")&&O.showInfo(J.test()),Y.tests(),window.onhashchange=function(){console.log("onhashchange event fired: location.hash="+location.hash)},console.log("window.onhashchange registered")}static HTMLGridBuilder_test1(){let t=new C;t.tab.className="serpGrid",t.tab.style.width="800px",t.tab.style.margin="auto";let e=t.addHeaderRow();e.className="serpHeaderRow";let r=t.createCell("headerCell1 ","confirmNo"),n=t.createCell("headerCell2 ","arrDate");r.dataset.fieldName="ReservationID";let i=new ut(e);i.createColumnSortElt(n,"f1");for(let e=0;e<5;e++)t.addDataRow(),i.createColumnSortElt(r,"f2"),t.addCell("cellx"+e,r),t.addCell("celly"+e,n);i.toggleSortDirection(n),i.toggleSortDirection(n),t.addDataRow(),t.addCell("c2"," c2last     class2 "),t.addCell("c2x"," c2last     class2 "),document.body.insertBefore(t.getTableElement(),document.body.firstChild)}static async handleDialogTests(){let t=location.href.toLowerCase();if(!t.includes("zz-"))return;let e=t.includes("zz-dialogs");t.includes("zz-help"),t.includes("zz-test"),(t.includes("zz-info")||e)&&O.showInfo("testing info"),t.includes("zz-showdialogs")&&O.showInfo("testing info"),(t.includes("zz-alert")||e)&&O.showAlert("testing alert"),(t.includes("zz-confirm")||e)&&O.showConfirm("testing confirm"),(t.includes("zz-warn")||e)&&O.showAlert("testing warn"),(t.includes("zz-error")||e)&&O.showUserError("testing error, this is a very long line.  use zz-boxes to show all","err")}}.runTests())}static async initAll(){if(alreadyExecuted("AppInit.initAll"))throw"dkwokd";Config.isUsingJQueryDialog=!0,console.log("... BoottstrappingFuncs.ts, {Config}=",Config),m.init(m.appName),await It.getConfigFromDataApiSvc(),await It.init("appAll"),Lt.SetDocumentTitle(m.appName),await Mt.processDirective_IncludeHtml(),class{static setupHamburgerMenuButton(){st.processTags();let t=qsNullable(".menu-wrap .toggler");if(null===t)return;let e=qs("#mainPopupMenu"),r=new Nt(e);r.hide();let n=t;n.addEventListener("click",(t=>{let e=t.target;r.toggle(e.checked)})),document.addEventListener("keyup",(function(t){if(!t.defaultPrevented&&n.checked){let e=t.key;"Escape"!==e&&"Esc"!==e||n.click()}})),document.addEventListener("click",(function(r){if(r.defaultPrevented)return;let i=r.target;if(i!==t&&n.checked){let t;t=null!==i&&!e.contains(i),t&&n.click()}})),p.searchParams.containsKey("zz-menu-open")&&setTimeout((()=>{n.click()}),100)}static setupUserManualLink(){let t=qs("#appUserManualLink");t.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let r=await z.fetchText("./userManual.htm");return t.setAttribute("disabled","disabled"),await O.showInfo(r,"REAMS Help"),t.removeAttribute("disabled"),!1})),location.href.includes("userManual")&&setTimeout((()=>{t.click()}),1)}static hilightSelectedMenuItem(t="header"){let e=qs(t),r=qsMany("a",0,100,e),n=location.href.toLowerCase(),i=null;for(let t of r)if(t instanceof HTMLAnchorElement){let e=t.href;if(e&&n.includes(e.toLowerCase())){i=t;break}}return i&&(i.className="appMenuItemSelected"),i}}.setupHamburgerMenuButton(),Lt.fixHyperLinks(),Lt.setPageFooterOnBottom(),Lt.populateBasicInfo(),bt.init(null),bt.setText("Application  loaded"),await It.postInit()}static async getConfigFromDataApiSvc(){var t;if(alreadyExecuted("AppInit.getConfigFromDataApiSvc"))return;const e=V.newDataApiClient("getDataSvcInfo?zxThrow"),r=await e.getPayloadWithBusyMesg("Loading DataSvcInfo");console.log("DataSvcInfo",r),W._username=r.username;let n=null!==(t=r.userRoles)&&void 0!==t?t:"";W._userRoles=n.toLocaleLowerCase(),m._publicFacingUrlRoot=r.publicFacingUrlRoot,m._dbEnv=r.dbEnv,m.DataApiVersion=r.apiVersion}}class Nt{constructor(t){this.DisplayOffValue="0px";let e=qs(t);this.targetElt=e}toggle(t){return void 0===t?this.isShowing()?this.hide():this.show():t?this.show():this.hide(),this.isShowing()}isShowing(){return!this.isHiding()}isHiding(){return this.targetElt.style.height===this.DisplayOffValue}show(){let t=this.targetElt;if(t.style.height===this.DisplayOffValue){if(1!==t.childElementCount)throw Error("Too many child elements");let e=t.children[0];t.style.height=Et.getOuterHeight_px(e)}else console.log("is already on");console.log("show elt done: ",t)}hide(){let t=this.targetElt;t.style.height===this.DisplayOffValue&&console.log("is already off"),t.style.height=this.DisplayOffValue,console.log("elt3 hide done: ",t)}}class At{constructor(t){if(this.gridDataRowClassName="serpDataRow",this.isLastNavigationSucceeded=!1,this.timerId=0,this.uiForm=t,this.nextButton=qsNullable("#navNextRecord",t.formElt),this.nextButton)this.prevButton=qs("#navPrevRecord",t.formElt);else{let t=qs("#recordNav");if(!t)throw Error("need some info");this.createNavigationButtons(t)}}setGridDataRowClassName(t){this.gridDataRowClassName=t}get gridDataRowSelector(){return"."+this.gridDataRowClassName}setFontSize(t){this.nextButton.style.fontSize=t,this.prevButton.style.fontSize=t}createNavigationButtons(t){let e=qs(t);{let t=document.createElement("button");t.style.opacity="0.3",t.title="Previous Record",t.appendChild(J.arrowBackElement),e.appendChild(t),this.prevButton=t}{let t=document.createElement("span");t.innerHTML="&nbsp; ",e.appendChild(t)}{let t=document.createElement("button");t.style.opacity="0.3",t.title="Next Record",t.appendChild(J.arrowForwardElement),e.appendChild(t),this.nextButton=t}}enableNextPrevRecordButtons(){this.uiForm;let t=this.getSelectedGridRow();if(null===t)return;let e=this.nextButton,r=this.prevButton;H.resetPropertyToOrig(e,"opacity"),H.resetPropertyToOrig(r,"opacity");{let r=t.nextElementSibling;r&&r.classList.contains(this.gridDataRowClassName)&&(H.setPropertySaveOrig(e,"opacity","1"),e.style.opacity="1")}{let e=t.previousElementSibling;e&&e.classList.contains(this.gridDataRowClassName)&&(H.setPropertySaveOrig(r,"opacity","1"),r.style.opacity="1")}}registerButtonClickedCallback(t){let e=async e=>{console.log("recordNav event: ",e),this.isLastNavigationSucceeded=!1,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let r,n=e.currentTarget;if(e instanceof KeyboardEvent)if(console.log("key is: ",e),"ArrowRight"===e.key)r=!0;else{if("ArrowLeft"!==e.key)return void e.key;r=!1}else r=n===this.nextButton;let i=this.getSelectedGridRow();if(i){let e=r?i.nextElementSibling:i.previousElementSibling;if(e&&e.classList.contains(this.gridDataRowClassName)){let r=qsMany("a",1,3,e)[0];console.log("nextRecord: ",r);let n=new P(r.dataset).getInt("keyId");console.log("calling callback with keyID: "+n),this.isLastNavigationSucceeded=!0,await t(n)}}};this.prevButton.addEventListener("click",e),this.prevButton.addEventListener("keyup",e),this.nextButton.addEventListener("click",e),this.nextButton.addEventListener("keyup",e)}enableButtonsAndHilightSelectedGridRow(){return this.enableNextPrevRecordButtons(),this.hilightSelectedGridRow()}hilightSelectedGridRow(){qsMany(this.gridDataRowSelector,0,1e3).forEach((t=>{t.style.backgroundColor=""}));let t=this.getSelectedGridRow();return null!=t&&(t.style.backgroundColor="lightyellow"),t}getSelectedGridRow(){let t=this.uiForm,e=t.keyID;if(!t.referrerDataGridID)throw console.log("form.referrerDataGridID is null"),Error("form.referrerDataGridID is null");let r=qsNullable("#"+t.referrerDataGridID);if(null===r)return console.log("form.referrerDataGridID is null"),null;let n=qsNullable(`a[data-key-id='${e}']`,r);return null===n?null:qsClosest(this.gridDataRowSelector,n)}startSlideShow(t){let e=this;console.log("slideshow starting..."),this.timerId=setInterval((()=>{e.nextButton.isConnected||this.stopSlideshow(),e.nextButton.click(),e.isLastNavigationSucceeded||this.stopSlideshow()}),t)}stopSlideshow(){this.timerId?(clearInterval(this.timerId),this.timerId=0,console.log("slideshow stopped")):console.log("slideshow already stopped")}restartSlideShow(t){this.stopSlideshow(),this.startSlideShow(t)}}class Rt{static removeNonPrintableAndWhitespaceChars(t){if(!t)return t;let e="",r=0;for(;r<t.length;r++){let n=t.codePointAt(r);if(void 0===n)throw Error("code is undefined at char: "+r);32<n&&n<=126?e+=String.fromCodePoint(n):console.warn("character removed, codePoint:"+n)}return e}static isValidASCIIOnlyData(t){let e=!0,r="";if(!t)return[e,r];let n=0;for(;n<t.length;n++){let i=t.codePointAt(n);if(void 0===i)throw Error("code is undefined at char: "+n);if(96===i){r="Back tick (`) is not allowed",e=!1;break}if(9===i){r="Tab character is not allowed",e=!1;break}if(!(32<=i&&i<=126||10===i||13===i)){r=`character with code point 0x[${i.toString(16)}] is not allowed`,e=!1;break}}return e||(r+=", bad character at position: "+n,r+=", after: "+t.substring(0,n)),[e,r]}static isValidASCIIOnlyData_test(){console.log("isValidASCIIOnlyData_test");let t=t=>{let[e,r]=this.isValidASCIIOnlyData(t);e?console.log(`${t} ${e}`):console.error(`${t} ${e} --info: ${r}`)};t("a\r\nsdfjklzAsadfZ0123456789"),t("as`dfjklzAsadfZ0123456789-"),t("a\tsdfjklzAsadfZ0123456789-`"),t("xé"),String.raw`safsd\r`}}class Bt{static collectFormData(t,e=!0){let r=new FormData(t);return ct.isAntiquatedBrowser&&(r=this.collectFormData2(t)),r}static collectFormData2(t,e=!0){const r=new FormData;let n,i=Array.prototype.slice.call(t.elements);for(n of i){let t=n.getAttribute("name");if(null==t){console.log("elt doesn't contain attribute [name]: "+n.tagName);continue}let e="";if(n instanceof HTMLInputElement)if("date"===n.type&&(e=n.value),"file"===n.type){if(null!=n.files){let e=n.files;if(console.log("elt",n),n.hasAttribute("multiple"))throw console.error("multiple files",n),Error("multiple files");if(e.length>0){let n=e.item(0);null!=n&&r.append(t,n)}}}else if("checkbox"===n.type){if(!n.checked)continue;e=n.value}else e=n.value;else(n instanceof HTMLTextAreaElement||n instanceof HTMLSelectElement)&&(e=n.value);console.log(`eltName=${t}, eltVal=${e}, type=${n.constructor}`);let[i,s]=Rt.isValidASCIIOnlyData(e);if(!i)throw Error("Field: "+t+"<br> "+s);r.append(t,e||"")}return r}static stringifyFormData(t){let e=new FormData(t),r=_.toObject(e);return JSON.stringify(r)}}!function(t){t.View="view",t.Add="add",t.Edit="edit",t.Search="search",t.Other="Other"}(a||(a={}));class Ot{constructor(t,e){this.formElt=uninit,this.clickedBtn=uninit,this.mouseEvent=uninit,this.keyID=uninit,this.dataSvc=uninit,this.recordName="Record",this.formType=a.Add,this.referrerDataGridID=null,this.isTouched=!1,this._isDirty=!1,this.formOriginalDataStr="?",this.primarySubmitBtn=uninit,this.domInt=uninit,this.DeleteBtnCSSSwitch=uninit,this.templateUrl="uninit",this.formType=e,this.formEvents=new N(this,"addComplete","editComplete","deleteComplete","beforeEdit","modify")}static setButtonAbortDefaultInnerHtml(t){Ot.buttonAbortDefaultInnerHtml=t}isPristine(){return!this.isDirty}get isDirty(){return this._isDirty}set isDirty(t){console.log("isDirty set to: "+t),this._isDirty=t}setupModifyEvents(){gt.setupChangeInputEvents(this.formElt,(t=>{console.log("formEvent: ",t),this.isTouched=!0,Bt.stringifyFormData(this.formElt)!==this.formOriginalDataStr?this.isDirty=!0:this.isDirty=!1,this.formEvents.fireEvent("modify",t)}))}get isUpdateForm(){return this.formType===a.Edit}get isInsertForm(){return this.formType===a.Add}get isViewForm(){return this.formType===a.View}get isSearchForm(){return this.formType===a.Search}closeForm(){}initButtonPane(t){this.buttonPane=new x,this.buttonPane.setParentContainer(t)}setupForm(t){this.formElt=t,this.buttonPane||this.initButtonPane(this.formElt),gt.setupID(t),gt.setFields_ID_and_LabelFor_fromName(t);{let t=this.buttonPane.addButton("defaultButtonz1",(function(){console.warn("default button hit, EnterKey pressed? ")}));t.setAttribute("type","submit"),t.style.display="none",t.onclick=t=>!1}if(this.buttonPane.buttonPaneElt.addEventListener("click",(e=>{if(e.target===this.buttonPane.buttonPaneElt&&0<e.offsetX&&e.offsetX<100&&0<e.offsetY&&e.offsetY<100&&e.ctrlKey){let e=this.dataSvc.getSampleData();Ht.filloutForm(t,e)}return!1})),this.isInsertForm){L.fixElementsForActivity("add",t);let e=this.buttonPane.addButtonSubmitPrimary("<i class='fa fa-plus'></i> Add "+this.recordName,myGlobalUIEventHandler);e.accessKey="k",e.classList.add("btnx-add"),this.setupPrimarySubmitButton(e)}else if(this.isUpdateForm){L.fixElementsForActivity("edit",t);let e=this.buttonPane.addButtonSubmitPrimary("<i class='fa fa-edit'></i> Update "+this.recordName,myGlobalUIEventHandler);e.accessKey="k",e.classList.add("btnx-update"),this.setupPrimarySubmitButton(e),Ot.autoSetupDeleteButtons&&(this.buttonDelete=this.buttonPane.addButtonDanger("<i class='fa fa-trash'></i> Delete "+this.recordName,(t=>{this.btnDelete_clicked(t)})),this.buttonDelete.classList.add("btnx-delete"))}this.buttonAbort=this.buttonPane.addButtonInfo(Ot.buttonAbortDefaultInnerHtml,(t=>{this.closeForm()})),this.buttonAbort.classList.add("btnx-abort"),this.buttonAbort.title="Press Esc key to close/exit",this.domInt===uninit&&(this.domInt=new it(t)),t.onsubmit=t=>{t.preventDefault(),this.submitForm()}}setupPrimarySubmitButton(t){if(this.primarySubmitBtn!==uninit)throw Error("primarySubmitBtn already set up");this.primarySubmitBtn=t,t.onclick=e=>{this.clickedBtn=t,this.mouseEvent=e}}async submitFormForAutomatedTest(){let t=this.showOverlay(`This ${this.recordName} is going to be ${this.formType}ed by automated test`);await t.hide(),this.clickedBtn=this.primarySubmitBtn,await this.submitForm()}async submitForm(){console.log("submitting form: clickedBtn=",this.clickedBtn);const t=this.clickedBtn;let e=t.textContent+"";if(!e)throw Error("btn clicked text is empty");const r=Bt.collectFormData(this.formElt);if(_.toStr(r,!0),console.log("....., clickedBtn="+e),e.includes("Add")){F.isTrue(this.isInsertForm,"clickedBtnText must include Add for insertForm");let t=Y.showOverlay("Adding "+this.recordName);try{let e=await this.dataSvc.post(r);if(await t.hide(),!e.isPayloadUserError){this.closeForm();let t=`The ${this.recordName} record has been added successfully`;bt.setText(t),await this.formEvents.fireEvent("addComplete",!0)}}catch(e){await t.hide(),console.warn("error3983 posting record",e)}}else{let e=this.formEvents.getEventHandlers("beforeEdit");for(let r of e)if(!await r.handler(t))return;F.isTrue(this.isUpdateForm,"clickedBtnText must include update for update Form");let n=Y.showOverlay("Saving "+this.recordName);try{let t=await this.dataSvc.put(this.keyID,r);if(await n.hide(),!t.isPayloadUserError){lastUIEvent instanceof MouseEvent&&lastUIEvent.ctrlKey?await O.showInfo("update done"+t.debugInfo):this.closeForm();let e=`The ${this.recordName} record has been updated successfully`;bt.setText(e),await this.formEvents.fireEvent("editComplete",!0)}}catch(t){throw await n.hide(),t}}}filloutForm(t,e=!0){if((this.isUpdateForm||t.KeyID)&&this.setKeyID(t.KeyID),!this.isInsertForm){let e=class{static fillSampleData(t){return t.InternalAdminNotes="Testing only, please ignore+ "+class{static generateGUID(){let t=window.crypto;return"xxxxxxxx-xxxx-4xxx-8xxx-xxxxxxxxxxxx".replace(/x/g,(function(){if(t&&t.getRandomValues){var e=new Uint8Array(1);return t.getRandomValues(e),(e[0]%16).toString(16)}return(16*Math.random()|0).toString(16)}))}static generateDecimal(t,e,r){let n=Math.pow(10,r),i=Math.random()*(e-t)+t;return i*=n,i=Math.round(i),i/=Math.pow(10,r),i}static generateParagraph_withLengths(...t){let e=t[Math.floor(Math.random()*t.length)];return this.generateParagraph(e,e)}static generateParagraph(t=1,e=1e3){if(t>e)throw Error("Invalid args, minLen GT maxLen");let r;r=t===e?t:Math.floor(Math.random()*(e-t))+t;let n=new y;for(let t=0;t<r;t++){let t=this.generateWord(3,20);if(t+=" ",n.length+t.length>e)break;n.append(t)}for(;n.length<t;)n.append(".");return n.toString()}static generateWord(t=1,e=20){if(t>e)throw Error("Invalid args, minLen GT maxLen");let r=Math.floor(Math.random()*(e-t)+t),n=new y;for(let t=0;t<r;t++)n.append(this.generateChar());return n.toString()}static generateChar(){let t="abcdefghijklmnopqrstuvwxyz";return t[Math.floor(Math.random()*(t.length-1))]}static generateInteger(t,e=Number.MAX_SAFE_INTEGER){Math.random();let r=Math.random()*(e-t)+t;return r=Math.round(r),r}static pickOne(...t){let e=this.generateInteger(0,t.length-1),r=t[e];return console.log(`generateFromArray, randomIndex=${e} rval=`+r),r}}.generateInteger(1,1e4),t}static isCanceled(t){var e;return 0===(null===(e=t.RecordStatus)||void 0===e?void 0:e.localeCompare("Canceled",void 0,{sensitivity:"base"}))}static getAuditInfo(t){if(Object(t)!==t){if("string"==typeof t)return"No auditInfo available, record is a string";throw Error("getAuditInfo, arg.ent must not be a primitive: "+typeof t)}let e="";if(t.CreatedOn){let r=t.CreatedOn,n=t.CreatedBy+""=="1"?"web":t.CreatedBy;try{e+=`Added by: ${n} on <time datetime='${r.toISOString()}'>${r.toLocaleDateString()} ${r.toLocaleTimeString()}</time>`}catch(n){e+=n+", CreatedOn="+t.CreatedOn+", type="+typeof r}}else e+="CreateOn is null";if(t.UpdatedOn){let r=t.UpdatedOn;if(!(r instanceof Date))throw Error(r+", UpdatedOn is not Date type: "+typeof r);let n="Updated by";t.RecordStatus&&"1"!==t.RecordStatus.toString()&&(n=`${t.RecordStatus} by`),e+=`<br>${n}: ${t.UpdatedBy} on <time datetime='${r.toISOString()}'>${r.toLocaleDateString()} ${r.toLocaleTimeString()}</time>`}return e+=`<br> RecordID: <span id='recordIDVersion'> ${t.KeyID}v${t.RecordVersion} </span>`,e}}.getAuditInfo(t),r=qsNullable(".audit-info",this.formElt);null!==r&&(r.innerHTML=e)}return Ht.filloutForm(this.formElt,t,e),this.domInt.expandWithDataObject(t),this.formOriginalDataStr=Bt.stringifyFormData(this.formElt),t}async fetchDataAndFilloutForm(t,e=!0){let r=`Loading ${this.recordName} data`,n=this.showOverlay(r);try{let r=await this.dataSvc.get(t);if("string"==typeof r)throw Error("data is a string");this.filloutForm(r,e),await n.hide()}finally{await n.hide()}}async fetchHtmlTextDataInto(t,e){let r=`Loading ${this.recordName} data`,n=this.showOverlay(r);try{let r=await this.dataSvc.get(t);if("string"!=typeof r)throw Error("data is not a string");qs(e,this.formElt).innerHTML=r,await n.hide()}finally{await n.hide()}}clearForm(){const t=new Tt;Ht.filloutForm(this.formElt,t),this.setKeyID(0)}static showOverlay(t){return Y.showOverlay(t)}showOverlay(t){return Ot.showOverlay(t)}setKeyID(t){if(void 0===t)throw Error("keyID cannot be undefined");if(null===t)throw Error("keyID cannot be null");if("string"==typeof t&&t.length<1)throw Error("keyID cannot be blank");this.keyID=t,this.formElt.dataset.keyId=this.keyID+""}getKeyID(){let t=this.formElt.dataset.keyId;if(!t)throw Error("keyId not found in FormElement dataset");return parseInt(t,10)}removeAbortButton(){this.buttonAbort&&this.buttonAbort.remove()}removeFunctionality_Delete(){this.hideDeleteButton()}hideDeleteButton(){this.buttonPane.getButton(".btnx-delete").style.display="none"}showDeleteButton(){this.buttonPane.getButton(".btnx-delete").style.display=""}disableDeleteButton(t){let e=this.buttonPane.getButton(".btnx-delete");if(!e.disabled){this.DeleteBtnCSSSwitch=new S(e);let r=this.DeleteBtnCSSSwitch;e.disabled=!0,r.switch("color","#bbb"),e.classList.add("tooltipx");let n=document.createElement("span");n.className="tooltiptext",n.innerHTML=t,e.appendChild(n)}}enableDeleteButton(){let t=this.buttonPane.getButton(".btnx-delete");t.classList.remove("tooltipx"),t.disabled=!1,this.DeleteBtnCSSSwitch!==uninit&&this.DeleteBtnCSSSwitch.reset();let e=qsNullable("span",t);e&&e.remove()}async enableOrDisableDeleteButton(t){if(!t)throw Error("keyID is required");let e=this;const r=await e.dataSvc.deletable(e.keyID);!0===r.value?e.enableDeleteButton():e.disableDeleteButton(r.reasons+"")}async btnDelete_clicked(t){console.log("Button Delete clicked, MouseEvent=",t),t.ctrlKey?await this.submitFormDelete(t):await O.showConfirmWarning(`Are you sure to delete this ${this.recordName}?`,"OK, Delete").then((async e=>{e?await this.submitFormDelete(t):console.log("does nothing, user aborted")}))}async clickOnDeleteButtonForAutomatedTest(){let t=this.showOverlay(`This ${this.recordName} is going to be deleted by automated test`);await t.hide(),await this.submitFormDelete("Automated")}async submitFormDelete(t){let e=this.showOverlay("Deleting "+this.recordName);try{let t=await this.dataSvc.delete(this.keyID);if(await e.hide(),!t.isPayloadUserError){let t=`The ${this.recordName} has been record successfully deleted`;bt.setText(t),this.closeForm(),await this.formEvents.fireEvent("deleteComplete",!0)}}catch(t){throw await e.hide(),t}}async submitFormSimple(t,e){let r=this,n=r.showOverlay(e),i=r.keyID;try{let e=await r.dataSvc.call(t,i);await n.hide(),e.isPayloadUserError}catch(t){throw await n.hide(),t}return i}setupRecordNavigator(t){this.recordNav=new At(this),this.recordNav.registerButtonClickedCallback(t)}async initAsyncBase(t){let e=await z.fetchText(this.templateUrl);t.innerHTML=e,this.buttonPane.setParentContainer(t);let r=qs("form",t);this.setupForm(r)}}Ot.autoSetupDeleteButtons=!0,Ot.buttonAbortDefaultInnerHtml="<i class='fa fa-ban'></i> Cancel";class Pt{constructor(){this.trueString="true",this.falseString="false"}static test1(){Boolean(1)}static isTruthy(t){let e=!this.isFalsy(t);return console.log(`BooleanX.isTruthy ${t} = ${e}`),e}static isFalsy(t){return"false"===this.toStr(t)}static valueOf(t){let e;if(null==t||""===t)e=!1;else{let r=this.valueOfOrUndefined(t);e=void 0!==r&&r}return e}static toStr(t){let e;if(null==t||""===t)e=(!1).toString();else{let r=this.valueOfOrUndefined(t);e=void 0===r?t+"":r.toString()}return e}static valueOfOrUndefined(t){let e;if(null==t||""===t)e=void 0;else if("boolean"==typeof t)e=t;else if(t instanceof Boolean)e=t.valueOf();else if("number"==typeof t)e=1===t||0!==t&&void 0;else if("string"==typeof t){let r=t.trim().toLowerCase();e="false"!==r&&"0"!==r&&"no"!==r&&"none"!==r&&("true"===r||"1"===r||"yes"===r||void 0)}else e=void 0;return console.log(`BooleanX.ValueOf ${t} is ${e}`),e}static areEqual(t,e){return this.valueOf(t)===this.valueOf(e)}static parse(t,e){if((null==t||""===t)&&void 0!==e)return e;let r=this.tryParse(t);if("boolean"!=typeof r)throw Error(`[${t}] is not a valid boolean value`);return r}static tryParse(t){return null==t||""===t||"boolean"==typeof t?t:0!==t&&(1===t||("string"==typeof t?"1"===(t=t.toLocaleLowerCase())||"on"===t||"ok"===t||"true"===t||"t"===t||"yes"===t||"y"===t||"0"!==t&&"off"!==t&&"!ok"!==t&&"false"!==t&&"f"!==t&&"no"!==t&&"n"!==t&&t:t))}}class Ht{constructor(t){if("string"==typeof t)this.elt=qs(t);else{if(!(t instanceof HTMLFormElement))throw Error("arg invalid type: "+typeof t+", val="+t);this.elt=t}}static filloutForm(t,e,r=!0){xt.showOwnProperties(e,"Filling out form data"),r&&t.reset();let n,i=Array.prototype.slice.call(t.elements);for(n of i){let t=n.getAttribute("name");if(null==t)continue;if(!(t in e))continue;let r=e[t],i=typeof r;null==r&&(r="");let s="";if(n instanceof HTMLTextAreaElement)n.value=r,s+="textArea.value";else if(n instanceof HTMLSelectElement)n.value=r,s+="select.value";else{if(!(n instanceof HTMLInputElement))throw Error("unknown elt: "+n.nodeName);if("date"===n.type){if(r instanceof Date)n.value=r.toISOString().slice(0,10);else if("number"==typeof r){let t=new Date(r);n.value=t.toISOString().slice(0,10)}else n.value=r;s+="input.date"}else"radio"===n.type?(Pt.toStr(n.value)===Pt.toStr(r)&&(n.checked=!0),s+="radio, presetVal="+n.value):"file"===n.type?s+="file.":(r instanceof Date&&(r=r.toLocaleDateString("en-US"),r=Rt.removeNonPrintableAndWhitespaceChars(r)),n.value=r,s+="input.else")}console.log(`filling form: ${t}=${r} ${i}, ${s}`)}}}class Mt{static async processDirective_IncludeHtml(){const t=document.querySelectorAll(`[${this.attrName}]`);for(let e=0;e<t.length;e++){const r=t.item(e),n=r.id;if(("header"===n||"footer"===n)&&null!=qsNullable(n)){r.id=n+"_alreadyDefined";continue}const i=r.getAttribute(this.attrName);i&&await z.fetchHtml_toHTMLElementSelector(r,i)}}}Mt.attrName="data-include-html",Mt.includeHtmlCount=0,windowExt.onDOMContentLoaded((function(){dt.init(),async function(){bt.disable(),await It.init("commonApps"),await async function(){let t="https://apps.fs.usda.gov/fiadb-api/fullreport?pselected=Artificial%20regen%20species&rselected=Forest%20Service%20Region&cselected=Condition%20proportion&snum=6&sdenom=59&wc=312020";vt.ahref(t),await z.fetchHtml_toHTMLElementSelector("#tempWorkspace1",t);let e=qsFirst(".dataframe.evalidTabs");vt.appendChild(e);let r=Dt.readData(e),n=class{static unpivot2(t){return t.map(((e,r)=>e.map(((e,n)=>t[t.length-1-n][r]))))}static unpivot(t){let e=t.length,r=t[0].length,n=[];F.isLessThan(e,20),F.isLessThan(r,20);for(let i=0;i<e;i++)for(let e=0;e<r;e++)n[e]||(n[e]=[]),n[e][i]=t[i][e];return n}}.unpivot(r);n[0][0]="",vt.html("h3","unpivoted:"),vt.appendChild(Dt.toHtml(n)),m.isMediaScreenMobile}(),document.documentElement.style.backgroundColor="unset",document.body.style.display="unset"}().catch((t=>{dt.HandleErrorFromMain(t)}))}))})()})();